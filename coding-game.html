<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Studio - Professional Development Environment</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header h1 {
      color: #2c3e50;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .header p {
      color: #7f8c8d;
      font-size: 1rem;
    }

    .main-container {
      display: flex;
      height: calc(100vh - 120px);
      padding: 1rem;
      gap: 1rem;
    }

    /* Game Emulator Section */
    .game-emulator {
      width: 300px;
      background: #20B2AA;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .game-screen {
      width: 200px;
      height: 150px;
      background: #000;
      border-radius: 10px;
      margin-bottom: 15px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 12px;
    }

    .sound-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      background: #ff4444;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 10px;
    }

    .game-controls {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .d-pad {
      width: 80px;
      height: 80px;
      background: #ccc;
      border-radius: 10px;
      position: relative;
    }

    .d-pad::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      background: #999;
      border-radius: 50%;
    }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .action-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }

    .btn-a {
      background: #ff6b6b;
      color: white;
    }

    .btn-b {
      background: #4ecdc4;
      color: white;
    }

    .menu-btn {
      background: #95a5a6;
      color: white;
      padding: 5px 15px;
      border: none;
      border-radius: 5px;
      margin: 10px 0;
    }

    .microsoft-logo {
      font-size: 10px;
      color: white;
      margin-top: 10px;
    }

    .emulator-toolbar {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .toolbar-btn {
      width: 25px;
      height: 25px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 3px;
      color: white;
      cursor: pointer;
    }

    /* Block Categories Section */
    .block-categories {
      width: 250px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .search-bar {
      padding: 1rem;
      border-bottom: 1px solid #e9ecef;
    }

    .search-input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    .categories-list {
      flex: 1;
      overflow-y: auto;
      padding: 0.5rem;
    }

    .category-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.2s;
      margin-bottom: 0.25rem;
    }

    .category-item:hover {
      background: #f8f9fa;
    }

    .category-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-size: 12px;
    }

    .category-text {
      font-size: 0.9rem;
      font-weight: 500;
    }

         /* Color coding for categories */
     .event { background: #27ae60; color: white; }
     .sprite { background: #3498db; color: white; }
     .controller { background: #e67e22; color: white; }
     .game { background: #9b59b6; color: white; }
     .music { background: #e91e63; color: white; }
     .scene { background: #27ae60; color: white; }
     .info { background: #e74c3c; color: white; }
     .loops { background: #2ecc71; color: white; }
     .logic { background: #3498db; color: white; }
     .variables { background: #e74c3c; color: white; }
     .math { background: #9b59b6; color: white; }
     .animation { background: #2ecc71; color: white; }
     .extensions { background: #95a5a6; color: white; }

    /* Coding Workspace */
    .coding-workspace {
      flex: 1;
      background: #f8f9fa;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .workspace-header {
      background: #fff;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .workspace-background {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: radial-gradient(circle, #ddd 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.3;
    }

    .workspace-content {
      position: relative;
      z-index: 1;
      padding: 2rem;
      min-height: 100%;
    }

    .start-block {
      background: #27ae60;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      display: inline-block;
      font-weight: 600;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
    }

    .block {
      display: inline-block;
      padding: 0.75rem 1rem;
      margin: 0.25rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
      user-select: none;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      min-width: 120px;
      text-align: center;
    }

    .block:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }

    /* Block connection points */
    .block::before {
      content: '';
      position: absolute;
      left: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      background: currentColor;
      border-radius: 50%;
      border: 2px solid white;
    }

    .block::after {
      content: '';
      position: absolute;
      right: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      background: currentColor;
      border-radius: 50%;
      border: 2px solid white;
    }

    /* Event blocks (rounded top) */
    .block.event {
      border-radius: 12px 12px 8px 8px;
      padding-top: 1.2rem;
    }

    .block.event::before {
      display: none;
    }

    /* Nested blocks */
    .block.nested {
      margin: 0.1rem 0;
      border-radius: 6px;
      position: relative;
    }

    .block.nested::before {
      display: none;
    }

    .block.nested::after {
      display: none;
    }

    /* Block container for nesting */
    .block-container {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 0.5rem;
      margin: 0.25rem 0;
      border: 2px dashed rgba(255, 255, 255, 0.3);
      min-height: 40px;
    }

    /* Snap indicators */
    .block.snap-target {
      border: 2px dashed #FFD700;
      background: rgba(255, 215, 0, 0.1);
    }

    .block.snap-hover {
      transform: scale(1.05);
      border: 2px solid #FFD700;
    }

    /* Block colors */
    .block.sprite { background: #3498db; color: white; }
    .block.controller { background: #e67e22; color: white; }
    .block.game { background: #9b59b6; color: white; }
    .block.music { background: #e91e63; color: white; }
    .block.scene { background: #27ae60; color: white; }
    .block.info { background: #e74c3c; color: white; }
    .block.loops { background: #2ecc71; color: white; }
    .block.logic { background: #3498db; color: white; }
    .block.variables { background: #e74c3c; color: white; }
    .block.math { background: #9b59b6; color: white; }
    .block.animation { background: #2ecc71; color: white; }

    /* Mode Switcher */
    .mode-switcher {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .mode-btn {
      padding: 0.75rem 1.5rem;
      border: 2px solid #3498db;
      background: transparent;
      color: #3498db;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .mode-btn.active {
      background: #3498db;
      color: white;
    }

    .mode-btn:hover {
      background: #3498db;
      color: white;
      transform: translateY(-2px);
    }

    /* Text Editor */
    .text-editor {
      display: none;
    }

    .text-editor.active {
      display: block;
    }

    .editor-section {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .editor-header {
      background: #2c3e50;
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .editor-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .editor-controls {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: #3498db;
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
      transform: translateY(-1px);
    }

    .btn-success {
      background: #27ae60;
      color: white;
    }

    .btn-success:hover {
      background: #229954;
      transform: translateY(-1px);
    }

    .code-editor {
      width: 100%;
      height: 400px;
      font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.5;
      padding: 1rem;
      border: none;
      resize: vertical;
      background: #1e1e1e;
      color: #d4d4d4;
      outline: none;
    }

    .output-section {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .output-header {
      background: #27ae60;
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

         .output-content {
       padding: 1rem;
       font-family: 'Courier New', monospace;
       font-size: 0.9rem;
       line-height: 1.4;
       background: #f8f9fa;
       min-height: 200px;
       max-height: 400px;
       overflow-y: auto;
     }

     /* Projects Section */
     .projects-section {
       background: #fff;
       border-radius: 12px;
       box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
       padding: 1.5rem;
       margin-top: 2rem;
     }

     .projects-title {
       font-size: 1.3rem;
       font-weight: 600;
       margin-bottom: 1rem;
       color: #2c3e50;
     }

     .project-tabs {
       display: flex;
       gap: 0.5rem;
       margin-bottom: 1rem;
       border-bottom: 2px solid #e9ecef;
     }

     .tab-btn {
       padding: 0.75rem 1.5rem;
       background: #f8f9fa;
       border: none;
       border-radius: 8px 8px 0 0;
       cursor: pointer;
       font-weight: 500;
       transition: all 0.2s;
       color: #6c757d;
     }

     .tab-btn.active {
       background: #007bff;
       color: white;
     }

     .tab-btn:hover:not(.active) {
       background: #e9ecef;
       color: #495057;
     }

     .tab-content {
       display: none;
     }

     .tab-content.active {
       display: block;
     }

     .projects-list {
       max-height: 300px;
       overflow-y: auto;
     }

     .project-item {
       background: #f8f9fa;
       border: 1px solid #e9ecef;
       border-radius: 6px;
       padding: 1rem;
       margin-bottom: 0.5rem;
       cursor: pointer;
       transition: all 0.2s;
     }

     .project-item:hover {
       background: #e9ecef;
       transform: translateX(4px);
     }

     .project-name {
       font-weight: 600;
       color: #2c3e50;
       margin-bottom: 0.25rem;
     }

     .project-info {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin: 0.5rem 0;
       font-size: 0.8rem;
       color: #7f8c8d;
     }

     .project-author {
       font-weight: 500;
       color: #3498db;
     }
     
     .project-date {
       color: #7f8c8d;
       font-size: 0.8rem;
     }
     
     .project-stats {
       display: flex;
       gap: 1rem;
       font-size: 0.8rem;
       color: #7f8c8d;
     }
     
     .project-downloads,
     .project-likes {
       display: flex;
       align-items: center;
       gap: 0.25rem;
     }

     .project-actions {
       margin-top: 0.5rem;
       display: flex;
       gap: 0.5rem;
     }

     .project-actions .btn {
       padding: 0.25rem 0.5rem;
       font-size: 0.8rem;
     }

     /* Modal */
     .modal {
       display: none;
       position: fixed;
       top: 0;
       left: 0;
       width: 100%;
       height: 100%;
       background: rgba(0, 0, 0, 0.5);
       z-index: 1000;
     }

     .modal-content {
       background: white;
       border-radius: 12px;
       padding: 2rem;
       max-width: 500px;
       margin: 10vh auto;
       box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
     }

     .modal-title {
       font-size: 1.5rem;
       font-weight: 600;
       margin-bottom: 1rem;
       color: #2c3e50;
     }

     .modal-input {
       width: 100%;
       padding: 0.75rem;
       border: 2px solid #e9ecef;
       border-radius: 6px;
       font-size: 1rem;
       margin-bottom: 1rem;
     }

     .modal-input:focus {
       outline: none;
       border-color: #3498db;
     }

     .modal-buttons {
       display: flex;
       gap: 1rem;
       justify-content: flex-end;
     }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .main-container {
        flex-direction: column;
        height: auto;
      }
      
      .game-emulator {
        width: 100%;
        max-width: 400px;
        margin: 0 auto;
      }
      
      .block-categories {
        width: 100%;
        max-height: 200px;
      }
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.5rem;
      }
      
      .main-container {
        padding: 0.5rem;
      }
      
      .workspace-content {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>🚀 Code Studio - Professional Development Environment</h1>
    <p>Create games and applications with visual block coding or text programming!</p>
  </div>

  <div class="mode-switcher">
    <button class="mode-btn active" onclick="switchMode('blocks')">🧱 Block Coding</button>
    <button class="mode-btn" onclick="switchMode('text')">📝 Text Editor</button>
  </div>

  <div class="main-container">
    <!-- Game Emulator -->
    <div class="game-emulator">
      <div class="game-screen">
        <div class="sound-toggle">🔇</div>
        <div id="game-display">Game Preview</div>
      </div>
      
      <div class="game-controls">
        <div class="d-pad"></div>
        <div class="action-buttons">
          <button class="action-btn btn-a">A</button>
          <button class="action-btn btn-b">B</button>
        </div>
      </div>
      
      <button class="menu-btn">Menu</button>
      <button class="menu-btn">🔄</button>
      
      <div class="microsoft-logo">Microsoft</div>
      
      <div class="emulator-toolbar">
        <button class="toolbar-btn">🔄</button>
        <button class="toolbar-btn">🐛</button>
        <button class="toolbar-btn">🔊</button>
        <button class="toolbar-btn">⌨️</button>
        <button class="toolbar-btn">📷</button>
        <button class="toolbar-btn">⛶</button>
      </div>
    </div>

    <!-- Block Categories -->
    <div class="block-categories">
      <div class="search-bar">
        <input type="text" class="search-input" placeholder="Search blocks..." onkeyup="filterCategories(this.value)">
      </div>
      
             <div class="categories-list">
         <div class="category-item" onclick="showBlocks('events')">
           <div class="category-icon event">🎯</div>
           <div class="category-text">Events</div>
         </div>
         
         <div class="category-item" onclick="showBlocks('sprite')">
           <div class="category-icon sprite">✈️</div>
           <div class="category-text">Sprites</div>
         </div>
        
        <div class="category-item" onclick="showBlocks('controller')">
          <div class="category-icon controller">🎮</div>
          <div class="category-text">Controller</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('game')">
          <div class="category-icon game">⚪</div>
          <div class="category-text">Game</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('music')">
          <div class="category-icon music">🎧</div>
          <div class="category-text">Music</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('scene')">
          <div class="category-icon scene">🌳</div>
          <div class="category-text">Scene</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('info')">
          <div class="category-icon info">👤</div>
          <div class="category-text">Info</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('loops')">
          <div class="category-icon loops">🔄</div>
          <div class="category-text">Loops</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('logic')">
          <div class="category-icon logic">🔗</div>
          <div class="category-text">Logic</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('variables')">
          <div class="category-icon variables">☰</div>
          <div class="category-text">Variables</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('math')">
          <div class="category-icon math">🧮</div>
          <div class="category-text">Math</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('animation')">
          <div class="category-icon animation">🎬</div>
          <div class="category-text">Animation</div>
        </div>
        
        <div class="category-item" onclick="showBlocks('extensions')">
          <div class="category-icon extensions">➕</div>
          <div class="category-text">Extensions</div>
        </div>
        
        <div class="category-item">
          <div class="category-icon" style="background: #95a5a6; color: white;">▼</div>
          <div class="category-text">Advanced</div>
        </div>
      </div>
    </div>

         <!-- Coding Workspace -->
     <div class="coding-workspace">
       <div class="workspace-header">
         <div class="editor-title">🧩 Block Workspace</div>
         <div class="editor-controls">
           <button class="btn btn-warning" id="save-blocks-btn">💾 Save</button>
           <button class="btn btn-success" id="publish-blocks-btn">📤 Publish</button>
           <button class="btn btn-primary" id="run-blocks-btn">▶️ Run Blocks</button>
         </div>
       </div>
       <div class="workspace-background"></div>
       <div class="workspace-content">
         <div id="block-workspace">
           <!-- Event blocks will be added here -->
         </div>
       </div>
     </div>
  </div>

     <!-- Text Editor (Hidden by default) -->
   <div class="text-editor">
     <div class="editor-section">
       <div class="editor-header">
         <div class="editor-title">📝 Code Editor</div>
         <div class="editor-controls">
           <button class="btn btn-warning" id="save-btn">💾 Save</button>
           <button class="btn btn-success" id="publish-btn">📤 Publish</button>
           <button class="btn btn-primary" id="run-btn">▶️ Run</button>
         </div>
       </div>
       <textarea id="code-input" class="code-editor">// Welcome to the JavaScript Code Editor!
// Write your code here and click "Run" to see the output

console.log('Hello, World!');

// Try some examples:
// - Create variables
let name = 'Coder';
let age = 25;

// - Use template literals
console.log(`Hello, ${name}! You are ${age} years old.`);

// - Create a function
function greet(person) {
  return `Hello, ${person}!`;
}

console.log(greet('Friend'));

// - Use arrays
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(n => n * 2);
console.log('Original:', numbers);
console.log('Doubled:', doubled);</textarea>
     </div>

     <div class="output-section">
       <div class="output-header">
         <div class="editor-title">📊 Output</div>
         <div class="editor-controls">
           <button class="btn btn-danger" id="clear-btn">🗑️ Clear</button>
         </div>
       </div>
       <div id="output" class="output-content">// Output will appear here when you run your code</div>
     </div>
   </div>

   <!-- Projects Section -->
   <div class="projects-section">
     <div class="projects-title">📚 Project Library</div>
     <div class="project-tabs">
       <button class="tab-btn active" onclick="showTab('saved', event)">💾 Saved Projects</button>
       <button class="tab-btn" onclick="showTab('published', event)">📤 Published Projects</button>
     </div>
     
     <!-- Saved Projects Tab -->
     <div id="saved-tab" class="tab-content active">
       <div class="editor-controls" style="margin-bottom: 1rem;">
         <button class="btn btn-success" onclick="saveCurrentProject()">💾 Save Current</button>
         <button class="btn btn-primary" onclick="loadSavedProjects()">📥 Load Saved</button>
       </div>
       <div id="saved-projects-list" class="projects-list">
         <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
           No saved projects yet. Save your first project!
         </div>
       </div>
     </div>

     <!-- Published Projects Tab -->
     <div id="published-tab" class="tab-content">
       <div class="editor-controls" style="margin-bottom: 1rem;">
         <button class="btn btn-primary" id="load-published-btn">📥 Load Published</button>
       </div>
       <div id="projects-list" class="projects-list">
         <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
           No published projects yet. Create some code and publish it!
         </div>
       </div>
     </div>
   </div>

   <!-- Save Modal -->
   <div id="save-modal" class="modal">
     <div class="modal-content">
       <div class="modal-title">💾 Save Project</div>
       <input type="text" id="project-name" class="modal-input" placeholder="Enter project name...">
       <div class="modal-buttons">
         <button class="btn btn-danger" id="cancel-save">Cancel</button>
         <button class="btn btn-success" id="confirm-save">Save</button>
       </div>
     </div>
   </div>

  <script src="js/token-manager.js"></script>
  <script src="js/project-manager.js"></script>
  <script>
         // Block definitions
     const blockCategories = {
       events: [
         { text: 'on start', code: '// Program starts here', color: 'event', type: 'event', canNest: true },
         { text: 'on game update', code: '// Game loop', color: 'event', type: 'event', canNest: true },
         { text: 'on A button pressed', code: 'input.onButtonPressed(Button.A, () => {\n  \n});', color: 'event', type: 'event', canNest: true },
         { text: 'on B button pressed', code: 'input.onButtonPressed(Button.B, () => {\n  \n});', color: 'event', type: 'event', canNest: true }
       ],
       
       sprite: [
         { text: 'set mySprite to sprite of kind Player', code: 'let mySprite = sprites.create(img`\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n`, SpriteKind.Player);', color: 'sprite', type: 'action', canNest: false },
         { text: 'set mySprite position to x 0 y 0', code: 'mySprite.setPosition(0, 0);', color: 'sprite', type: 'action', canNest: false },
         { text: 'move mySprite by x 0 y 0', code: 'mySprite.moveBy(0, 0);', color: 'sprite', type: 'action', canNest: false },
         { text: 'turn mySprite by degrees 0', code: 'mySprite.turnBy(0);', color: 'sprite', type: 'action', canNest: false },
         { text: 'animate mySprite with fly to center for 2000ms loop OFF', code: 'mySprite.animate(AnimationKind.FlyToCenter, 2000, false);', color: 'sprite', type: 'action', canNest: false }
       ],
      
             controller: [
         { text: 'when A button pressed', code: 'input.onButtonPressed(Button.A, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when B button pressed', code: 'input.onButtonPressed(Button.B, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when up pressed', code: 'input.onButtonPressed(Button.Up, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when down pressed', code: 'input.onButtonPressed(Button.Down, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when left pressed', code: 'input.onButtonPressed(Button.Left, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when right pressed', code: 'input.onButtonPressed(Button.Right, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'is A pressed', code: 'input.buttonIsPressed(Button.A)', color: 'controller', type: 'condition', canNest: false },
         { text: 'is B pressed', code: 'input.buttonIsPressed(Button.B)', color: 'controller', type: 'condition', canNest: false }
       ],
      
             game: [
         { text: 'game over WIN', code: 'game.over(true);', color: 'game', type: 'action', canNest: false },
         { text: 'game over LOSE', code: 'game.over(false);', color: 'game', type: 'action', canNest: false },
         { text: 'add score 0', code: 'info.changeScoreBy(0);', color: 'game', type: 'action', canNest: false },
         { text: 'set score to 0', code: 'info.setScore(0);', color: 'game', type: 'action', canNest: false },
         { text: 'add life 0', code: 'info.changeLifeBy(0);', color: 'game', type: 'action', canNest: false },
         { text: 'set life to 0', code: 'info.setLife(0);', color: 'game', type: 'action', canNest: false },
         { text: 'pause', code: 'game.pause();', color: 'game', type: 'action', canNest: false },
         { text: 'resume', code: 'game.resume();', color: 'game', type: 'action', canNest: false }
       ],
      
      music: [
        { text: 'play tone at 0 for 0', code: 'music.playTone(0, 0);', color: 'music' },
        { text: 'play melody', code: 'music.playMelody("", 120);', color: 'music' },
        { text: 'play melody until done', code: 'music.playMelodyUntilDone("", 120);', color: 'music' },
        { text: 'stop all sounds', code: 'music.stopAllSounds();', color: 'music' },
        { text: 'set volume 0', code: 'music.setVolume(0);', color: 'music' },
        { text: 'change volume by 0', code: 'music.changeVolumeBy(0);', color: 'music' }
      ],
      
             scene: [
         { text: 'set background image to', code: 'scene.setBackgroundImage(img`\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n`);', color: 'scene', type: 'action', canNest: false },
         { text: 'set background color to', code: 'scene.setBackgroundColor(0);', color: 'scene', type: 'action', canNest: false },
         { text: 'set tile to', code: 'scene.setTile();', color: 'scene', type: 'action', canNest: false },
         { text: 'set tile at x:0 y:0 to', code: 'scene.setTileAt(0, 0);', color: 'scene', type: 'action', canNest: false },
         { text: 'replace all tiles with', code: 'scene.replaceAllTiles();', color: 'scene', type: 'action', canNest: false }
       ],
      
      info: [
        { text: 'show number 0', code: 'basic.showNumber(0);', color: 'info' },
        { text: 'show string "hello"', code: 'basic.showString("hello");', color: 'info' },
        { text: 'show icon', code: 'basic.showIcon(IconNames.Heart);', color: 'info' },
        { text: 'show arrow', code: 'basic.showArrow(ArrowNames.North);', color: 'info' },
        { text: 'show leds', code: 'basic.showLeds(`\n.#.#.\n#.#.#\n.#.#.\n#.#.#\n.#.#.\n`);', color: 'info' },
        { text: 'clear screen', code: 'basic.clearScreen();', color: 'info' },
        { text: 'pause 0', code: 'basic.pause(0);', color: 'info' }
      ],
      
      loops: [
        { text: 'repeat 0 times', code: 'for (let i = 0; i < 0; i++) {\n  \n}', color: 'loops' },
        { text: 'repeat while', code: 'while (true) {\n  \n}', color: 'loops' },
        { text: 'for index from 0 to 0', code: 'for (let index = 0; index <= 0; index++) {\n  \n}', color: 'loops' },
        { text: 'for each value in list', code: 'for (let value of list) {\n  \n}', color: 'loops' }
      ],
      
      logic: [
        { text: 'if true then', code: 'if (true) {\n  \n}', color: 'logic' },
        { text: 'if true then else', code: 'if (true) {\n  \n} else {\n  \n}', color: 'logic' },
        { text: '= 0', code: '=== 0', color: 'logic' },
        { text: '< 0', code: '< 0', color: 'logic' },
        { text: '> 0', code: '> 0', color: 'logic' },
        { text: 'and', code: '&&', color: 'logic' },
        { text: 'or', code: '||', color: 'logic' },
        { text: 'not', code: '!', color: 'logic' }
      ],
      
             variables: [
         { text: 'set gfg to 0', code: 'let gfg = 0;', color: 'variables', type: 'action', canNest: false },
         { text: 'set myVariable to 0', code: 'let myVariable = 0;', color: 'variables', type: 'action', canNest: false },
         { text: 'change myVariable by 0', code: 'myVariable += 0;', color: 'variables', type: 'action', canNest: false },
         { text: 'show variable myVariable', code: 'basic.showNumber(myVariable);', color: 'variables', type: 'action', canNest: false },
         { text: 'set myVariable to "hello"', code: 'let myVariable = "hello";', color: 'variables', type: 'action', canNest: false }
       ],
      
      math: [
        { text: '0 + 0', code: '0 + 0', color: 'math' },
        { text: '0 - 0', code: '0 - 0', color: 'math' },
        { text: '0 × 0', code: '0 * 0', color: 'math' },
        { text: '0 ÷ 0', code: '0 / 0', color: 'math' },
        { text: 'pick random 0 to 0', code: 'Math.randomRange(0, 0)', color: 'math' },
        { text: '0 mod 0', code: '0 % 0', color: 'math' },
        { text: '0 ^ 0', code: 'Math.pow(0, 0)', color: 'math' },
        { text: '√ 0', code: 'Math.sqrt(0)', color: 'math' },
        { text: 'sin 0', code: 'Math.sin(0)', color: 'math' },
        { text: 'cos 0', code: 'Math.cos(0)', color: 'math' },
        { text: 'tan 0', code: 'Math.tan(0)', color: 'math' },
        { text: 'log 0', code: 'Math.log(0)', color: 'math' },
        { text: 'e ^ 0', code: 'Math.exp(0)', color: 'math' },
        { text: '10 ^ 0', code: 'Math.pow(10, 0)', color: 'math' }
      ],
      
      animation: [
        { text: 'set animation frame to 0', code: 'sprite.setAnimationFrame(0);', color: 'animation' },
        { text: 'change animation frame by 0', code: 'sprite.changeAnimationFrameBy(0);', color: 'animation' },
        { text: 'set animation frame interval to 0', code: 'sprite.setAnimationFrameInterval(0);', color: 'animation' },
        { text: 'start animation', code: 'sprite.startAnimation();', color: 'animation' },
        { text: 'stop animation', code: 'sprite.stopAnimation();', color: 'animation' }
      ],
      
      extensions: [
        { text: 'Advanced Blocks', code: '// Advanced functionality', color: 'extensions' },
        { text: 'Custom Functions', code: 'function customFunction() {\n  \n}', color: 'extensions' },
        { text: 'API Calls', code: 'fetch("https://api.example.com/data")', color: 'extensions' },
        { text: 'Local Storage', code: 'localStorage.setItem("key", "value");', color: 'extensions' }
      ]
    };

         let currentMode = 'blocks';
     let currentCategory = null;
     let workspaceBlocks = [];
     let draggedBlock = null;
     let snapTargets = [];

     // Switch between block coding and text editor
     function switchMode(mode) {
       currentMode = mode;
       
       // Update button states
       document.querySelectorAll('.mode-btn').forEach(btn => {
         btn.classList.remove('active');
       });
       event.target.classList.add('active');
       
       // Show/hide sections
       if (mode === 'blocks') {
         document.querySelector('.main-container').style.display = 'flex';
         document.querySelector('.text-editor').style.display = 'none';
       } else {
         document.querySelector('.main-container').style.display = 'none';
         document.querySelector('.text-editor').style.display = 'block';
       }
     }

     // Show blocks for a specific category
     function showBlocks(category) {
       currentCategory = category;
       const blocks = blockCategories[category] || [];
       
       // Create block selection area
       const workspace = document.getElementById('block-workspace');
       workspace.innerHTML = '';
       
       // Add category title
       const title = document.createElement('h3');
       title.textContent = category.charAt(0).toUpperCase() + category.slice(1) + ' Blocks';
       title.style.marginBottom = '1rem';
       title.style.color = '#2c3e50';
       workspace.appendChild(title);
       
       // Add blocks
       blocks.forEach(block => {
         const blockElement = document.createElement('div');
         blockElement.className = `block ${block.color}`;
         if (block.type === 'event') {
           blockElement.classList.add('event');
         }
         blockElement.textContent = block.text;
         blockElement.draggable = true;
         blockElement.dataset.block = JSON.stringify(block);
         
         blockElement.addEventListener('dragstart', (e) => {
           draggedBlock = block;
           e.dataTransfer.setData('text/plain', JSON.stringify(block));
         });
         
         blockElement.addEventListener('click', () => {
           addBlockToWorkspace(block);
         });
         
         workspace.appendChild(blockElement);
       });
     }

     // Add block to workspace
     function addBlockToWorkspace(block) {
       const workspace = document.querySelector('.workspace-content');
       
       if (block.type === 'event') {
         // Create event block with nesting container
         const eventContainer = document.createElement('div');
         eventContainer.className = 'block event ' + block.color;
         eventContainer.textContent = block.text;
         eventContainer.dataset.block = JSON.stringify(block);
         
         const nestContainer = document.createElement('div');
         nestContainer.className = 'block-container';
         nestContainer.dataset.parent = block.text;
         
         eventContainer.appendChild(nestContainer);
         workspace.appendChild(eventContainer);
         
         // Make the nest container a drop target
         makeDropTarget(nestContainer);
       } else {
         // Create regular block
         const blockElement = document.createElement('div');
         blockElement.className = `block ${block.color} nested`;
         blockElement.textContent = block.text;
         blockElement.dataset.block = JSON.stringify(block);
         blockElement.draggable = true;
         
         // Make it a drop target for other blocks
         makeDropTarget(blockElement);
         
         workspace.appendChild(blockElement);
       }
       
       workspaceBlocks.push(block);
       updateGeneratedCode();
     }

     // Make an element a drop target
     function makeDropTarget(element) {
       element.addEventListener('dragover', (e) => {
         e.preventDefault();
         element.classList.add('snap-target');
       });
       
       element.addEventListener('dragleave', () => {
         element.classList.remove('snap-target');
       });
       
       element.addEventListener('drop', (e) => {
         e.preventDefault();
         element.classList.remove('snap-target');
         
         const blockData = JSON.parse(e.dataTransfer.getData('text/plain'));
         if (blockData.type !== 'event') {
           // Add the dropped block as a nested block
           const nestedBlock = document.createElement('div');
           nestedBlock.className = `block ${blockData.color} nested`;
           nestedBlock.textContent = blockData.text;
           nestedBlock.dataset.block = JSON.stringify(blockData);
           
           element.appendChild(nestedBlock);
           workspaceBlocks.push(blockData);
           updateGeneratedCode();
         }
       });
     }

     // Update generated code from blocks
     function updateGeneratedCode() {
       let code = '// Generated code from blocks\n\n';
       
       // Find all event blocks in workspace
       const eventBlocks = document.querySelectorAll('.block.event');
       eventBlocks.forEach(eventBlock => {
         const blockData = JSON.parse(eventBlock.dataset.block);
         code += blockData.code + '\n';
         
         // Find nested blocks
         const nestedBlocks = eventBlock.querySelectorAll('.block.nested');
         nestedBlocks.forEach(nestedBlock => {
           const nestedData = JSON.parse(nestedBlock.dataset.block);
           code += '  ' + nestedData.code + '\n';
         });
         
         if (blockData.code.includes('() => {')) {
           code += '});\n';
         }
         code += '\n';
       });
       
       // Update text editor if in text mode
       const codeInput = document.getElementById('code-input');
       if (codeInput) {
         codeInput.value = code;
       }
     }

     // Filter categories
     function filterCategories(searchTerm) {
       const categories = document.querySelectorAll('.category-item');
       categories.forEach(category => {
         const text = category.querySelector('.category-text').textContent.toLowerCase();
         if (text.includes(searchTerm.toLowerCase())) {
           category.style.display = 'flex';
         } else {
           category.style.display = 'none';
         }
       });
     }

         // Initialize
     document.addEventListener('DOMContentLoaded', function() {
       // Show default category
       showBlocks('events');
       
       // Add some sample blocks to workspace
       const sampleBlocks = [
         blockCategories.events[0], // on start
         blockCategories.sprite[0], // set mySprite to sprite of kind Player
         blockCategories.sprite[1], // set mySprite position to x 0 y 0
         blockCategories.variables[0], // set gfg to 0
         blockCategories.scene[0], // set background image to
         blockCategories.events[1], // on game update
         blockCategories.game[0], // game over WIN
         blockCategories.sprite[4] // animate mySprite with fly to center
       ];
       
       // Add event blocks first
       sampleBlocks.filter(block => block.type === 'event').forEach(block => {
         addBlockToWorkspace(block);
       });
       
       // Then add action blocks to the first event block
       const firstEventBlock = document.querySelector('.block.event');
       if (firstEventBlock) {
         const nestContainer = firstEventBlock.querySelector('.block-container');
         if (nestContainer) {
           sampleBlocks.filter(block => block.type !== 'event').forEach(block => {
             const nestedBlock = document.createElement('div');
             nestedBlock.className = `block ${block.color} nested`;
             nestedBlock.textContent = block.text;
             nestedBlock.dataset.block = JSON.stringify(block);
             nestContainer.appendChild(nestedBlock);
           });
         }
       }
      
      // Initialize text editor functionality
      const runBtn = document.getElementById('run-btn');
      const output = document.getElementById('output');
      const codeInput = document.getElementById('code-input');
      const clearBtn = document.getElementById('clear-btn');
      
      if (runBtn) {
        runBtn.addEventListener('click', () => {
          try {
            const code = codeInput.value;
            const originalLog = console.log;
            let outputText = '';
            
            console.log = function(...args) {
              outputText += args.join(' ') + '\n';
              originalLog.apply(console, args);
            };
            
            eval(code);
            console.log = originalLog;
            
            output.textContent = outputText || 'Code executed successfully!';
          } catch (error) {
            output.textContent = 'Error: ' + error.message;
          }
        });
      }
      
             if (clearBtn) {
         clearBtn.addEventListener('click', () => {
           output.textContent = '// Output cleared';
         });
       }

       // Project management
       let savedProjects = JSON.parse(localStorage.getItem('codingProjects') || '[]');
       let publishedProjects = {};

       // DOM elements for projects
       const saveBtn = document.getElementById('save-btn');
       const publishBtn = document.getElementById('publish-btn');
       const loadPublishedBtn = document.getElementById('load-published-btn');
       const saveModal = document.getElementById('save-modal');
       const projectNameInput = document.getElementById('project-name');
       const confirmSaveBtn = document.getElementById('confirm-save');
       const cancelSaveBtn = document.getElementById('cancel-save');

       // Save project locally
       function saveCurrentProject() {
         const projectName = prompt('Enter a name for your project:');
         if (!projectName) return;

         const project = {
           name: projectName,
           code: codeInput.value,
           date: new Date().toISOString(),
           id: Date.now()
         };

         savedProjects.push(project);
         localStorage.setItem('codingProjects', JSON.stringify(savedProjects));
         
         alert(`Project "${projectName}" saved successfully!`);
         loadSavedProjects();
       }

       // Load saved projects from localStorage
       function loadSavedProjects() {
         const savedProjectsList = document.getElementById('saved-projects-list');
         
         if (savedProjects.length === 0) {
           savedProjectsList.innerHTML = `
             <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
               No saved projects yet. Save your first project!
             </div>
           `;
           return;
         }

         savedProjectsList.innerHTML = savedProjects
           .sort((a, b) => new Date(b.date) - new Date(a.date))
           .map(project => `
             <div class="project-item" onclick="loadSavedProject('${project.id}')">
               <div class="project-name">${project.name}</div>
               <div class="project-info">
                 <span class="project-date">Saved: ${new Date(project.date).toLocaleDateString()}</span>
               </div>
               <div class="project-actions">
                 <button class="btn btn-danger" onclick="deleteSavedProject('${project.id}', event)">🗑️ Delete</button>
               </div>
             </div>
           `).join('');
       }

       // Load a specific saved project
       function loadSavedProject(projectId) {
         const project = savedProjects.find(p => p.id == projectId);
         if (project) {
           codeInput.value = project.code;
           alert(`Loaded project: ${project.name}`);
         }
       }

       // Delete a saved project
       function deleteSavedProject(projectId, event) {
         event.stopPropagation();
       
         if (confirm('Are you sure you want to delete this project?')) {
           savedProjects = savedProjects.filter(p => p.id != projectId);
           localStorage.setItem('codingProjects', JSON.stringify(savedProjects));
           loadSavedProjects();
           alert('Project deleted successfully!');
         }
       }

       // Publish project to cloud
       async function publishProject() {
         const projectName = prompt('Enter a name for your published project:');
         if (!projectName) return;

         try {
           console.log('🔄 Publishing project:', projectName);
           
           const project = {
             name: projectName,
             code: codeInput.value,
             description: 'JavaScript project',
             author: 'Anonymous',
             language: 'javascript'
           };

           const publishedProject = await window.projectManager.publishProject(project);
           console.log('🔄 Published project response:', publishedProject);
           
           alert(`Project "${projectName}" published successfully to the cloud!`);
           
           setTimeout(() => {
             loadPublishedProjects();
           }, 1000);
         } catch (error) {
           console.error('❌ Error publishing project:', error);
           alert('Failed to publish project. Please try again.');
         }
       }

       // Load published projects from cloud
       async function loadPublishedProjects() {
         try {
           console.log('🔄 Starting to load published projects...');
           publishedProjects = await window.projectManager.getPublishedProjects();
           console.log('🔄 Received projects:', publishedProjects);
           
           const projectIds = Object.keys(publishedProjects);
           
           if (projectIds.length === 0) {
             document.getElementById('projects-list').innerHTML = `
               <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
                 No published projects yet. Create some code and publish it!
               </div>
             `;
             return;
           }

           document.getElementById('projects-list').innerHTML = projectIds
             .sort((a, b) => new Date(publishedProjects[b].publishedAt) - new Date(publishedProjects[a].publishedAt))
             .map(projectId => {
               const project = publishedProjects[projectId];
               return `
                 <div class="project-item" onclick="loadProject('${projectId}')">
                   <div class="project-name">${project.name}</div>
                   <div class="project-info">
                     <span class="project-author">by ${project.author}</span>
                     <span class="project-date">Published: ${new Date(project.publishedAt).toLocaleDateString()}</span>
                   </div>
                   <div class="project-stats">
                     <span class="project-downloads">📥 ${project.downloads || 0}</span>
                     <span class="project-likes">❤️ ${project.likes || 0}</span>
                   </div>
                 </div>
               `;
             }).join('');
         } catch (error) {
           console.error('❌ Error loading projects:', error);
           document.getElementById('projects-list').innerHTML = `
             <div style="text-align: center; color: #e74c3c; padding: 2rem;">
               Error loading projects. Please try again.
             </div>
           `;
         }
       }

       // Load a specific project from cloud
       async function loadProject(projectId) {
         const project = publishedProjects[projectId];
         if (project) {
           try {
             await window.projectManager.downloadProject(projectId);
             codeInput.value = project.code;
             alert(`Loaded project: ${project.name}`);
             loadPublishedProjects();
           } catch (error) {
             console.error('❌ Error loading project:', error);
             codeInput.value = project.code;
             alert(`Loaded project: ${project.name}`);
           }
         }
       }

       // Tab switching function
       function showTab(tabName, event) {
         document.querySelectorAll('.tab-content').forEach(tab => {
           tab.classList.remove('active');
         });
         
         document.querySelectorAll('.tab-btn').forEach(btn => {
           btn.classList.remove('active');
         });
         
         document.getElementById(tabName + '-tab').classList.add('active');
         if (event && event.target) {
           event.target.classList.add('active');
         }
         
         if (tabName === 'saved') {
           loadSavedProjects();
         } else if (tabName === 'published') {
           loadPublishedProjects();
         }
       }

       // Block coding save and publish functions
       function saveBlockProject() {
         const projectName = prompt('Enter a name for your block project:');
         if (!projectName) return;

         const project = {
           name: projectName,
           type: 'blocks',
           blocks: workspaceBlocks,
           generatedCode: generateCodeFromBlocks(),
           date: new Date().toISOString(),
           id: Date.now()
         };

         savedProjects.push(project);
         localStorage.setItem('codingProjects', JSON.stringify(savedProjects));
         
         alert(`Block project "${projectName}" saved successfully!`);
         loadSavedProjects();
       }

       function publishBlockProject() {
         const projectName = prompt('Enter a name for your published block project:');
         if (!projectName) return;

         try {
           console.log('🔄 Publishing block project:', projectName);
           
           const project = {
             name: projectName,
             type: 'blocks',
             blocks: workspaceBlocks,
             code: generateCodeFromBlocks(),
             description: 'Block coding project',
             author: 'Anonymous',
             language: 'javascript'
           };

           window.projectManager.publishProject(project).then(publishedProject => {
             console.log('🔄 Published block project response:', publishedProject);
             alert(`Block project "${projectName}" published successfully to the cloud!`);
             
             setTimeout(() => {
               loadPublishedProjects();
             }, 1000);
           }).catch(error => {
             console.error('❌ Error publishing block project:', error);
             alert('Failed to publish block project. Please try again.');
           });
         } catch (error) {
           console.error('❌ Error publishing block project:', error);
           alert('Failed to publish block project. Please try again.');
         }
       }

       function generateCodeFromBlocks() {
         // Generate JavaScript code from the visual blocks
         let code = '// Generated from block coding\n\n';
         
         workspaceBlocks.forEach(block => {
           if (block.code) {
             code += block.code + '\n';
           }
         });
         
         return code;
       }

       // Event listeners
       if (saveBtn) saveBtn.addEventListener('click', saveCurrentProject);
       if (publishBtn) publishBtn.addEventListener('click', publishProject);
       if (loadPublishedBtn) loadPublishedBtn.addEventListener('click', loadPublishedProjects);

       // Block coding event listeners
       const saveBlocksBtn = document.getElementById('save-blocks-btn');
       const publishBlocksBtn = document.getElementById('publish-blocks-btn');
       const runBlocksBtn = document.getElementById('run-blocks-btn');

       if (saveBlocksBtn) saveBlocksBtn.addEventListener('click', saveBlockProject);
       if (publishBlocksBtn) publishBlocksBtn.addEventListener('click', publishBlockProject);
       if (runBlocksBtn) runBlocksBtn.addEventListener('click', () => {
         const code = generateCodeFromBlocks();
         codeInput.value = code;
         runCode();
       });

       // Initialize projects
       loadSavedProjects();
       loadPublishedProjects();
       
       // Debug: Check if project manager is loaded
       console.log('🔍 Project Manager loaded:', window.projectManager);
       console.log('🔍 Token Manager loaded:', window.tokenManager);
       
       // Debug: Check if projects section exists
       const projectsSection = document.querySelector('.projects-section');
       console.log('🔍 Projects section found:', projectsSection);
       
       // Debug: Check if tab buttons exist
       const tabButtons = document.querySelectorAll('.tab-btn');
       console.log('🔍 Tab buttons found:', tabButtons.length);
     });
  </script>
</body>
</html> 
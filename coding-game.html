<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Studio - Professional Development Environment</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header h1 {
      color: #2c3e50;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .header p {
      color: #7f8c8d;
      font-size: 1rem;
    }

    .main-container {
      display: flex;
      height: calc(100vh - 120px);
      padding: 1rem;
      gap: 1rem;
    }

    /* Game Emulator Section */
    .game-emulator {
      width: 300px;
      background: #20B2AA;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .game-screen {
      width: 200px;
      height: 150px;
      background: #000;
      border-radius: 10px;
      margin-bottom: 15px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 12px;
    }

    .sound-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      background: #ff4444;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 10px;
    }

    .game-controls {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .d-pad {
      width: 80px;
      height: 80px;
      background: #ccc;
      border-radius: 10px;
      position: relative;
    }

    .d-pad::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      background: #999;
      border-radius: 50%;
    }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .action-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }

    .btn-a {
      background: #ff6b6b;
      color: white;
    }

    .btn-b {
      background: #4ecdc4;
      color: white;
    }

    .menu-btn {
      background: #95a5a6;
      color: white;
      padding: 5px 15px;
      border: none;
      border-radius: 5px;
      margin: 10px 0;
    }

    .microsoft-logo {
      font-size: 10px;
      color: white;
      margin-top: 10px;
    }

    .emulator-toolbar {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .toolbar-btn {
      width: 25px;
      height: 25px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 3px;
      color: white;
      cursor: pointer;
    }

    /* Block Categories Section */
    .block-categories {
      width: 250px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .block-categories .categories-list {
      max-height: 500px;
      overflow-y: auto;
    }

    .search-bar {
      padding: 1rem;
      border-bottom: 1px solid #e9ecef;
    }

    .search-input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    .categories-list {
      flex: 1;
      overflow-y: auto;
      padding: 0.5rem;
    }

         .category-item {
       display: flex;
       align-items: center;
       gap: 0.75rem;
       padding: 0.75rem;
       cursor: pointer;
       border-radius: 6px;
       transition: all 0.2s;
       margin-bottom: 0.25rem;
       background: rgba(255, 255, 255, 0.05);
       border: 1px solid rgba(255, 255, 255, 0.1);
     }

     .category-item:hover {
       background: rgba(255, 255, 255, 0.1);
       transform: translateX(4px);
     }

     .category-item.expanded {
       background: rgba(52, 152, 219, 0.2);
       border-color: rgba(52, 152, 219, 0.3);
     }

    .category-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-size: 12px;
    }

    .category-text {
      font-size: 0.9rem;
      font-weight: 500;
    }

         /* Color coding for categories */
     .event { background: #27ae60; color: white; }
     .sprite { background: #3498db; color: white; }
     .controller { background: #e67e22; color: white; }
     .game { background: #9b59b6; color: white; }
     .music { background: #e91e63; color: white; }
     .scene { background: #27ae60; color: white; }
     .info { background: #e74c3c; color: white; }
     .loops { background: #2ecc71; color: white; }
     .logic { background: #3498db; color: white; }
     .variables { background: #e74c3c; color: white; }
     .math { background: #9b59b6; color: white; }
     .animation { background: #2ecc71; color: white; }
     .extensions { background: #95a5a6; color: white; }

    /* Coding Workspace */
    .coding-workspace {
      flex: 1;
      background: #f8f9fa;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .workspace-header {
      background: #fff;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .workspace-background {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: radial-gradient(circle, #ddd 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.3;
    }

    .workspace-content {
      position: relative;
      z-index: 1;
      padding: 2rem;
      min-height: 100%;
    }

    .start-block {
      background: #27ae60;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      display: inline-block;
      font-weight: 600;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
    }

    .block {
      display: inline-block;
      padding: 0.75rem 1rem;
      margin: 0.25rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
      user-select: none;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      min-width: 120px;
      text-align: center;
    }

    .block:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }

    /* Block connection points */
    .block::before {
      content: '';
      position: absolute;
      left: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      background: currentColor;
      border-radius: 50%;
      border: 2px solid white;
    }

    .block::after {
      content: '';
      position: absolute;
      right: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      background: currentColor;
      border-radius: 50%;
      border: 2px solid white;
    }

    /* Event blocks (rounded top) */
    .block.event {
      border-radius: 12px 12px 8px 8px;
      padding-top: 1.2rem;
    }

    .block.event::before {
      display: none;
    }

    /* Nested blocks */
    .block.nested {
      margin: 0.1rem 0;
      border-radius: 6px;
      position: relative;
    }

    .block.nested::before {
      display: none;
    }

    .block.nested::after {
      display: none;
    }

    /* Block container for nesting */
    .block-container {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 0.5rem;
      margin: 0.25rem 0;
      border: 2px dashed rgba(255, 255, 255, 0.3);
      min-height: 40px;
    }

    /* Examples Section */
    .examples-section {
      margin-top: 2rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .examples-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #fff;
    }

    .examples-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.5rem;
    }

    .example-btn {
      padding: 0.75rem;
      background: rgba(52, 152, 219, 0.2);
      border: 1px solid rgba(52, 152, 219, 0.3);
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
    }

    .example-btn:hover {
      background: rgba(52, 152, 219, 0.3);
      transform: translateY(-2px);
    }

    /* Improve block responsiveness */
    .block {
      transition: all 0.2s ease;
    }

    .block:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .block:active {
      transform: scale(0.98);
    }

    .category-item {
      transition: all 0.2s ease;
    }

         .category-item:hover {
       transform: translateX(4px);
       background: rgba(255, 255, 255, 0.1);
     }

     /* Category rollout system */
     .category-arrow {
       margin-left: auto;
       transition: transform 0.3s ease;
       color: #fff;
       font-size: 0.8rem;
       font-weight: bold;
     }

     .category-item.expanded .category-arrow {
       transform: rotate(180deg);
     }

     .category-item.expanded .category-arrow {
       transform: rotate(180deg);
     }

     .category-blocks {
       background: rgba(255, 255, 255, 0.05);
       border-radius: 6px;
       margin: 0.25rem 0;
       padding: 0.5rem;
       border-left: 3px solid rgba(255, 255, 255, 0.2);
       max-height: 300px;
       overflow-y: auto;
       display: none;
     }

     .category-blocks[style*="display: block"] {
       display: block !important;
     }

     .category-blocks .block-item {
       background: #f8f9fa;
       border: 1px solid #e9ecef;
       border-radius: 6px;
       padding: 0.75rem;
       margin: 0.5rem 0;
       cursor: grab;
       transition: all 0.2s ease;
       font-size: 0.9rem;
       color: #333;
       display: block;
       font-weight: 500;
       box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
     }

     .category-blocks .block-item:hover {
       background: #e9ecef;
       transform: translateX(4px);
       box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
     }

     .category-blocks .block-item:active {
       cursor: grabbing;
     }

     .block-item {
       background: rgba(255, 255, 255, 0.1);
       border: 1px solid rgba(255, 255, 255, 0.2);
       border-radius: 6px;
       padding: 0.5rem;
       margin: 0.25rem 0;
       cursor: grab;
       transition: all 0.2s ease;
       font-size: 0.85rem;
       color: #fff;
     }

     .block-item:hover {
       background: rgba(255, 255, 255, 0.2);
       transform: translateX(4px);
     }

     .block-item:active {
       cursor: grabbing;
     }

     /* Drawing Tools */
     .drawing-tools {
       background: rgba(255, 255, 255, 0.05);
       border-radius: 8px;
       padding: 1rem;
       margin-bottom: 1rem;
       border: 1px solid rgba(255, 255, 255, 0.1);
     }

     .tools-header {
       font-size: 1rem;
       font-weight: 600;
       margin-bottom: 1rem;
       color: #fff;
     }

     .tool-buttons {
       display: flex;
       gap: 0.5rem;
       margin-bottom: 1rem;
       flex-wrap: wrap;
     }

     .tool-btn {
       width: 40px;
       height: 40px;
       border: 2px solid rgba(255, 255, 255, 0.3);
       background: rgba(255, 255, 255, 0.1);
       border-radius: 6px;
       cursor: pointer;
       transition: all 0.2s;
       display: flex;
       align-items: center;
       justify-content: center;
       font-size: 1.2rem;
     }

     .tool-btn.active {
       background: #3498db;
       border-color: #3498db;
     }

     .tool-btn:hover {
       background: rgba(255, 255, 255, 0.2);
       transform: scale(1.1);
     }

     .color-palette {
       display: grid;
       grid-template-columns: repeat(8, 1fr);
       gap: 0.25rem;
     }

     .color-swatch {
       width: 20px;
       height: 20px;
       border-radius: 4px;
       cursor: pointer;
       border: 2px solid rgba(255, 255, 255, 0.3);
       transition: all 0.2s;
     }

     .color-swatch:hover {
       transform: scale(1.2);
       border-color: #fff;
     }

     .color-swatch.transparent { background: repeating-conic-gradient(#ccc 0% 25%, transparent 0% 50%) 50% / 20% 20%; }
     .color-swatch.white { background: #fff; }
     .color-swatch.red { background: #ff0000; }
     .color-swatch.pink { background: #ff69b4; }
     .color-swatch.orange { background: #ffa500; }
     .color-swatch.yellow { background: #ffff00; }
     .color-swatch.lightgreen { background: #90ee90; }
     .color-swatch.darkgreen { background: #228b22; }
     .color-swatch.lightblue { background: #87ceeb; }
     .color-swatch.darkblue { background: #0000ff; }
     .color-swatch.purple { background: #800080; }
     .color-swatch.lightpurple { background: #dda0dd; }
     .color-swatch.brown { background: #a0522d; }
     .color-swatch.beige { background: #f5f5dc; }
     .color-swatch.black { background: #000; }

     /* Game Canvas and Controls */
     #game-canvas {
       border: 2px solid #333;
       border-radius: 8px;
       background: #000;
       display: block;
       margin: 0 auto;
     }

     .game-overlay {
       position: absolute;
       top: 10px;
       left: 10px;
       right: 10px;
       pointer-events: none;
     }

     .game-info {
       display: flex;
       justify-content: space-between;
       color: #fff;
       font-weight: 600;
       text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
     }

     .joystick-container {
       position: relative;
       width: 80px;
       height: 80px;
     }

     .joystick {
       width: 80px;
       height: 80px;
       border-radius: 50%;
       background: rgba(255, 255, 255, 0.2);
       border: 2px solid rgba(255, 255, 255, 0.3);
       position: relative;
       cursor: pointer;
     }

     .joystick-knob {
       width: 30px;
       height: 30px;
       border-radius: 50%;
       background: #fff;
       position: absolute;
       top: 50%;
       left: 50%;
       transform: translate(-50%, -50%);
       transition: all 0.1s ease;
     }

     .action-buttons {
       display: flex;
       gap: 1rem;
     }

     .action-btn {
       width: 50px;
       height: 50px;
       border-radius: 50%;
       background: rgba(255, 255, 255, 0.2);
       border: 2px solid rgba(255, 255, 255, 0.3);
       color: #fff;
       font-weight: 600;
       cursor: pointer;
       transition: all 0.2s;
     }

     .action-btn:active {
       background: rgba(255, 255, 255, 0.4);
       transform: scale(0.95);
     }

    /* Snap indicators */
    .block.snap-target {
      border: 2px dashed #FFD700;
      background: rgba(255, 215, 0, 0.1);
    }

    .block.snap-hover {
      transform: scale(1.05);
      border: 2px solid #FFD700;
    }

    /* Block colors */
    .block.sprite { background: #3498db; color: white; }
    .block.controller { background: #e67e22; color: white; }
    .block.game { background: #9b59b6; color: white; }
    .block.music { background: #e91e63; color: white; }
    .block.scene { background: #27ae60; color: white; }
    .block.info { background: #e74c3c; color: white; }
    .block.loops { background: #2ecc71; color: white; }
    .block.logic { background: #3498db; color: white; }
    .block.variables { background: #e74c3c; color: white; }
    .block.math { background: #9b59b6; color: white; }
    .block.animation { background: #2ecc71; color: white; }

    /* Mode Switcher */
    .mode-switcher {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .mode-btn {
      padding: 0.75rem 1.5rem;
      border: 2px solid #3498db;
      background: transparent;
      color: #3498db;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .mode-btn.active {
      background: #3498db;
      color: white;
    }

    .mode-btn:hover {
      background: #3498db;
      color: white;
      transform: translateY(-2px);
    }

    /* Text Editor */
    .text-editor {
      display: none;
    }

    .text-editor.active {
      display: block;
    }

    .editor-section {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .editor-header {
      background: #2c3e50;
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .editor-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .editor-controls {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: #3498db;
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
      transform: translateY(-1px);
    }

    .btn-success {
      background: #27ae60;
      color: white;
    }

    .btn-success:hover {
      background: #229954;
      transform: translateY(-1px);
    }

    .code-editor {
      width: 100%;
      height: 400px;
      font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.5;
      padding: 1rem;
      border: none;
      resize: vertical;
      background: #1e1e1e;
      color: #d4d4d4;
      outline: none;
    }

    .output-section {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .output-header {
      background: #27ae60;
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

         .output-content {
       padding: 1rem;
       font-family: 'Courier New', monospace;
       font-size: 0.9rem;
       line-height: 1.4;
       background: #f8f9fa;
       min-height: 200px;
       max-height: 400px;
       overflow-y: auto;
     }

     /* Projects Section */
     .projects-section {
       background: #fff;
       border-radius: 12px;
       box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
       padding: 1.5rem;
       margin-top: 2rem;
     }

     .projects-title {
       font-size: 1.3rem;
       font-weight: 600;
       margin-bottom: 1rem;
       color: #2c3e50;
     }

     .project-tabs {
       display: flex;
       gap: 0.5rem;
       margin-bottom: 1rem;
       border-bottom: 2px solid #e9ecef;
     }

     .tab-btn {
       padding: 0.75rem 1.5rem;
       background: #f8f9fa;
       border: none;
       border-radius: 8px 8px 0 0;
       cursor: pointer;
       font-weight: 500;
       transition: all 0.2s;
       color: #6c757d;
     }

     .tab-btn.active {
       background: #007bff;
       color: white;
     }

     .tab-btn:hover:not(.active) {
       background: #e9ecef;
       color: #495057;
     }

     .tab-content {
       display: none;
     }

     .tab-content.active {
       display: block;
     }

     .projects-list {
       max-height: 300px;
       overflow-y: auto;
     }

     .project-item {
       background: #f8f9fa;
       border: 1px solid #e9ecef;
       border-radius: 6px;
       padding: 1rem;
       margin-bottom: 0.5rem;
       cursor: pointer;
       transition: all 0.2s;
     }

     .project-item:hover {
       background: #e9ecef;
       transform: translateX(4px);
     }

     .project-name {
       font-weight: 600;
       color: #2c3e50;
       margin-bottom: 0.25rem;
     }

     .project-info {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin: 0.5rem 0;
       font-size: 0.8rem;
       color: #7f8c8d;
     }

     .project-author {
       font-weight: 500;
       color: #3498db;
     }
     
     .project-date {
       color: #7f8c8d;
       font-size: 0.8rem;
     }
     
     .project-stats {
       display: flex;
       gap: 1rem;
       font-size: 0.8rem;
       color: #7f8c8d;
     }
     
     .project-downloads,
     .project-likes {
       display: flex;
       align-items: center;
       gap: 0.25rem;
     }

     .project-actions {
       margin-top: 0.5rem;
       display: flex;
       gap: 0.5rem;
     }

     .project-actions .btn {
       padding: 0.25rem 0.5rem;
       font-size: 0.8rem;
     }

     /* Modal */
     .modal {
       display: none;
       position: fixed;
       top: 0;
       left: 0;
       width: 100%;
       height: 100%;
       background: rgba(0, 0, 0, 0.5);
       z-index: 1000;
     }

     .modal-content {
       background: white;
       border-radius: 12px;
       padding: 2rem;
       max-width: 500px;
       margin: 10vh auto;
       box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
     }

     .modal-title {
       font-size: 1.5rem;
       font-weight: 600;
       margin-bottom: 1rem;
       color: #2c3e50;
     }

     .modal-input {
       width: 100%;
       padding: 0.75rem;
       border: 2px solid #e9ecef;
       border-radius: 6px;
       font-size: 1rem;
       margin-bottom: 1rem;
     }

     .modal-input:focus {
       outline: none;
       border-color: #3498db;
     }

     .modal-buttons {
       display: flex;
       gap: 1rem;
       justify-content: flex-end;
     }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .main-container {
        flex-direction: column;
        height: auto;
      }
      
      .game-emulator {
        width: 100%;
        max-width: 400px;
        margin: 0 auto;
      }
      
      .block-categories {
        width: 100%;
        max-height: 200px;
      }
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.5rem;
      }
      
      .main-container {
        padding: 0.5rem;
      }
      
      .workspace-content {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üöÄ Code Studio - Professional Development Environment</h1>
    <p>Create games and applications with visual block coding or text programming!</p>
    </div>

  <div class="mode-switcher">
    <button class="mode-btn active" onclick="switchMode('blocks')">üß± Block Coding</button>
    <button class="mode-btn" onclick="switchMode('text')">üìù Text Editor</button>
  </div>

  <div class="main-container">
    <!-- Game Emulator -->
    <div class="game-emulator">
      <div class="game-screen">
        <div class="sound-toggle">üîá</div>
        <canvas id="game-canvas" width="320" height="240"></canvas>
        <div class="game-overlay">
          <div class="game-info">
            <span id="game-score">Score: 0</span>
            <span id="game-lives">Lives: 3</span>
          </div>
        </div>
      </div>
      
      <div class="game-controls">
        <div class="joystick-container">
          <div class="joystick" id="joystick">
            <div class="joystick-knob" id="joystick-knob"></div>
          </div>
        </div>
        <div class="action-buttons">
          <button class="action-btn btn-a" id="btn-a">A</button>
          <button class="action-btn btn-b" id="btn-b">B</button>
        </div>
      </div>
      
      <button class="menu-btn" onclick="toggleGameMenu()">Menu</button>
      <button class="menu-btn" onclick="resetGame()">üîÑ</button>
      
      <div class="microsoft-logo">Microsoft</div>
      
      <div class="emulator-toolbar">
        <button class="toolbar-btn" onclick="toggleSound()">üîä</button>
        <button class="toolbar-btn" onclick="toggleFullscreen()">‚õ∂</button>
        <button class="toolbar-btn" onclick="takeScreenshot()">üì∑</button>
        <button class="toolbar-btn" onclick="toggleDebug()">üêõ</button>
      </div>
    </div>

    <!-- Drawing Tools -->
    <div class="drawing-tools">
      <div class="tools-header">üé® Drawing Tools</div>
      <div class="tool-buttons">
        <button class="tool-btn active" onclick="selectTool('pencil')" title="Pencil">‚úèÔ∏è</button>
        <button class="tool-btn" onclick="selectTool('square')" title="Square">‚¨ú</button>
        <button class="tool-btn" onclick="selectTool('circle')" title="Circle">‚≠ï</button>
        <button class="tool-btn" onclick="selectTool('line')" title="Line">‚ûñ</button>
        <button class="tool-btn" onclick="selectTool('fill')" title="Fill">üñåÔ∏è</button>
        <button class="tool-btn" onclick="selectTool('select')" title="Select">üëÜ</button>
      </div>
      <div class="color-palette">
        <div class="color-swatch transparent" onclick="selectColor('transparent')"></div>
        <div class="color-swatch white" onclick="selectColor('white')"></div>
        <div class="color-swatch red" onclick="selectColor('red')"></div>
        <div class="color-swatch pink" onclick="selectColor('pink')"></div>
        <div class="color-swatch orange" onclick="selectColor('orange')"></div>
        <div class="color-swatch yellow" onclick="selectColor('yellow')"></div>
        <div class="color-swatch lightgreen" onclick="selectColor('lightgreen')"></div>
        <div class="color-swatch darkgreen" onclick="selectColor('darkgreen')"></div>
        <div class="color-swatch lightblue" onclick="selectColor('lightblue')"></div>
        <div class="color-swatch darkblue" onclick="selectColor('darkblue')"></div>
        <div class="color-swatch purple" onclick="selectColor('purple')"></div>
        <div class="color-swatch lightpurple" onclick="selectColor('lightpurple')"></div>
        <div class="color-swatch brown" onclick="selectColor('brown')"></div>
        <div class="color-swatch beige" onclick="selectColor('beige')"></div>
        <div class="color-swatch black" onclick="selectColor('black')"></div>
      </div>
    </div>

    <!-- Block Categories -->
    <div class="block-categories">
      <div class="search-bar">
        <input type="text" class="search-input" placeholder="Search blocks..." onkeyup="filterCategories(this.value)">
      </div>
      
             <div class="categories-list">
         <div class="category-item" onclick="toggleCategory('events')">
           <div class="category-icon event">üéØ</div>
           <div class="category-text">Events</div>
           <div class="category-arrow">‚ñº</div>
         </div>
         <div class="category-blocks" id="events-blocks" style="display: none;">
           <div class="block-item" draggable="true" data-block='{"type":"event","text":"When program starts","color":"event","code":"// Program starts here"}'>When program starts</div>
           <div class="block-item" draggable="true" data-block='{"type":"event","text":"When A button pressed","color":"event","code":"// A button pressed"}'>When A button pressed</div>
           <div class="block-item" draggable="true" data-block='{"type":"event","text":"When B button pressed","color":"event","code":"// B button pressed"}'>When B button pressed</div>
           <div class="block-item" draggable="true" data-block='{"type":"event","text":"When sprite overlaps","color":"event","code":"// Sprite overlap detected"}'>When sprite overlaps</div>
           <div class="block-item" draggable="true" data-block='{"type":"event","text":"When sprite hits wall","color":"event","code":"// Sprite hits wall"}'>When sprite hits wall</div>
           <div class="block-item" draggable="true" data-block='{"type":"event","text":"When score reaches","color":"event","code":"// Score threshold reached"}'>When score reaches</div>
           <div class="block-item" draggable="true" data-block='{"type":"event","text":"When timer expires","color":"event","code":"// Timer expired"}'>When timer expires</div>
           <div class="block-item" draggable="true" data-block='{"type":"event","text":"When game starts","color":"event","code":"// Game starts"}'>When game starts</div>
           <div class="block-item" draggable="true" data-block='{"type":"event","text":"When game ends","color":"event","code":"// Game ends"}'>When game ends</div>
         </div>
         
         <div class="category-item" onclick="toggleCategory('sprite')">
           <div class="category-icon sprite">‚úàÔ∏è</div>
           <div class="category-text">Sprites</div>
           <div class="category-arrow">‚ñº</div>
         </div>
         <div class="category-blocks" id="sprite-blocks" style="display: none;">
           <div class="block-item" draggable="true" data-block='{"type":"sprite","text":"Create sprite","color":"sprite","code":"let sprite = createSprite();"}'>Create sprite</div>
           <div class="block-item" draggable="true" data-block='{"type":"sprite","text":"Set sprite position","color":"sprite","code":"sprite.setPosition(x, y);"}'>Set sprite position</div>
           <div class="block-item" draggable="true" data-block='{"type":"sprite","text":"Move sprite","color":"sprite","code":"sprite.move(direction);"}'>Move sprite</div>
           <div class="block-item" draggable="true" data-block='{"type":"sprite","text":"Set sprite image","color":"sprite","code":"sprite.setImage(image);"}'>Set sprite image</div>
         </div>
        
        <div class="category-item" onclick="toggleCategory('controller')">
          <div class="category-icon controller">üéÆ</div>
          <div class="category-text">Controller</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="controller-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"controller","text":"Move with buttons","color":"controller","code":"moveWithButtons(sprite);"}'>Move with buttons</div>
          <div class="block-item" draggable="true" data-block='{"type":"controller","text":"Is A pressed","color":"controller","code":"isButtonPressed('A')"}'>Is A pressed</div>
          <div class="block-item" draggable="true" data-block='{"type":"controller","text":"Is B pressed","color":"controller","code":"isButtonPressed('B')"}'>Is B pressed</div>
          <div class="block-item" draggable="true" data-block='{"type":"controller","text":"Get joystick X","color":"controller","code":"getJoystickX()"}'>Get joystick X</div>
          <div class="block-item" draggable="true" data-block='{"type":"controller","text":"Get joystick Y","color":"controller","code":"getJoystickY()"}'>Get joystick Y</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('game')">
          <div class="category-icon game">‚ö™</div>
          <div class="category-text">Game</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="game-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"game","text":"Set score","color":"game","code":"setScore(value);"}'>Set score</div>
          <div class="block-item" draggable="true" data-block='{"type":"game","text":"Add score","color":"game","code":"addScore(points);"}'>Add score</div>
          <div class="block-item" draggable="true" data-block='{"type":"game","text":"Set lives","color":"game","code":"setLives(lives);"}'>Set lives</div>
          <div class="block-item" draggable="true" data-block='{"type":"game","text":"Game over","color":"game","code":"gameOver();"}'>Game over</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('scene')">
          <div class="category-icon scene">üå≥</div>
          <div class="category-text">Scene</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="scene-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"scene","text":"Set background","color":"scene","code":"setBackground(color);"}'>Set background</div>
          <div class="block-item" draggable="true" data-block='{"type":"scene","text":"Set background image","color":"scene","code":"setBackgroundImage(image);"}'>Set background image</div>
          <div class="block-item" draggable="true" data-block='{"type":"scene","text":"Camera follow sprite","color":"scene","code":"cameraFollow(sprite);"}'>Camera follow sprite</div>
          <div class="block-item" draggable="true" data-block='{"type":"scene","text":"Camera shake","color":"scene","code":"cameraShake(intensity, duration);"}'>Camera shake</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('info')">
          <div class="category-icon info">üë§</div>
          <div class="category-text">Info</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="info-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"info","text":"Say hello","color":"info","code":"console.log('Hello!');"}'>Say hello</div>
          <div class="block-item" draggable="true" data-block='{"type":"info","text":"Show score","color":"info","code":"console.log('Score:', score);"}'>Show score</div>
          <div class="block-item" draggable="true" data-block='{"type":"info","text":"Show lives","color":"info","code":"console.log('Lives:', lives);"}'>Show lives</div>
          <div class="block-item" draggable="true" data-block='{"type":"info","text":"Show position","color":"info","code":"console.log('Position:', x, y);"}'>Show position</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('loops')">
          <div class="category-icon loops">üîÑ</div>
          <div class="category-text">Loops</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="loops-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"loops","text":"Repeat 10 times","color":"loops","code":"for(let i = 0; i < 10; i++) {"}'>Repeat 10 times</div>
          <div class="block-item" draggable="true" data-block='{"type":"loops","text":"Forever","color":"loops","code":"while(true) {"}'>Forever</div>
          <div class="block-item" draggable="true" data-block='{"type":"loops","text":"Repeat until","color":"loops","code":"while(!condition) {"}'>Repeat until</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('logic')">
          <div class="category-icon logic">üîó</div>
          <div class="category-text">Logic</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="logic-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"logic","text":"If then","color":"logic","code":"if(condition) {"}'>If then</div>
          <div class="block-item" draggable="true" data-block='{"type":"logic","text":"If else","color":"logic","code":"if(condition) { } else {"}'>If else</div>
          <div class="block-item" draggable="true" data-block='{"type":"logic","text":"Wait 1 second","color":"logic","code":"await sleep(1000);"}'>Wait 1 second</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('variables')">
          <div class="category-icon variables">‚ò∞</div>
          <div class="category-text">Variables</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="variables-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"variables","text":"Set variable","color":"variables","code":"let variable = value;"}'>Set variable</div>
          <div class="block-item" draggable="true" data-block='{"type":"variables","text":"Change variable","color":"variables","code":"variable += 1;"}'>Change variable</div>
          <div class="block-item" draggable="true" data-block='{"type":"variables","text":"Get variable","color":"variables","code":"variable"}'>Get variable</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('math')">
          <div class="category-icon math">üßÆ</div>
          <div class="category-text">Math</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="math-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"math","text":"Add numbers","color":"math","code":"a + b"}'>Add numbers</div>
          <div class="block-item" draggable="true" data-block='{"type":"math","text":"Subtract numbers","color":"math","code":"a - b"}'>Subtract numbers</div>
          <div class="block-item" draggable="true" data-block='{"type":"math","text":"Multiply numbers","color":"math","code":"a * b"}'>Multiply numbers</div>
          <div class="block-item" draggable="true" data-block='{"type":"math","text":"Random number","color":"math","code":"Math.random() * max"}'>Random number</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('animation')">
          <div class="category-icon animation">‚ú®</div>
          <div class="category-text">Animation</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="animation-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"animation","text":"Animate sprite","color":"animation","code":"sprite.animate();"}'>Animate sprite</div>
          <div class="block-item" draggable="true" data-block='{"type":"animation","text":"Set animation speed","color":"animation","code":"sprite.setAnimationSpeed(speed);"}'>Set animation speed</div>
          <div class="block-item" draggable="true" data-block='{"type":"animation","text":"Play sound","color":"animation","code":"playSound(sound);"}'>Play sound</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('extensions')">
          <div class="category-icon extensions">‚ûï</div>
          <div class="category-text">Extensions</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="extensions-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"extensions","text":"HTTP request","color":"extensions","code":"fetch(url)"}'>HTTP request</div>
          <div class="block-item" draggable="true" data-block='{"type":"extensions","text":"Save data","color":"extensions","code":"localStorage.setItem(key, value);"}'>Save data</div>
          <div class="block-item" draggable="true" data-block='{"type":"extensions","text":"Load data","color":"extensions","code":"localStorage.getItem(key);"}'>Load data</div>
        </div>
        
        <div class="category-item" onclick="toggleCategory('advanced')">
          <div class="category-icon" style="background: #95a5a6; color: white;">‚ñº</div>
          <div class="category-text">Advanced</div>
          <div class="category-arrow">‚ñº</div>
        </div>
        <div class="category-blocks" id="advanced-blocks" style="display: none;">
          <div class="block-item" draggable="true" data-block='{"type":"advanced","text":"Custom function","color":"advanced","code":"function myFunction() {"}'>Custom function</div>
          <div class="block-item" draggable="true" data-block='{"type":"advanced","text":"Class definition","color":"advanced","code":"class MyClass {"}'>Class definition</div>
          <div class="block-item" draggable="true" data-block='{"type":"advanced","text":"Async function","color":"advanced","code":"async function myAsyncFunction() {"}'>Async function</div>
        </div>
      </div>
    </div>

         <!-- Coding Workspace -->
     <div class="coding-workspace">
       <div class="workspace-header">
         <div class="editor-title">üß© Block Workspace</div>
         <div class="editor-controls">
           <button class="btn btn-warning" id="save-blocks-btn">üíæ Save</button>
           <button class="btn btn-success" id="publish-blocks-btn">üì§ Publish</button>
           <button class="btn btn-primary" id="run-blocks-btn">‚ñ∂Ô∏è Run Blocks</button>
         </div>
       </div>
       <div class="workspace-background"></div>
       <div class="workspace-content">
         <div id="block-workspace">
           <!-- Event blocks will be added here -->
         </div>
         
         <!-- Examples Section -->
         <div class="examples-section">
           <div class="examples-title">üí° Quick Examples</div>
           <div class="examples-grid">
             <button class="example-btn" onclick="loadExample('hello')">üëã Hello World</button>
             <button class="example-btn" onclick="loadExample('game')">üéÆ Simple Game</button>
             <button class="example-btn" onclick="loadExample('animation')">‚ú® Animation</button>
             <button class="example-btn" onclick="loadExample('math')">üßÆ Calculator</button>
           </div>
         </div>
       </div>
     </div>
  </div>

     <!-- Text Editor (Hidden by default) -->
   <div class="text-editor">
     <div class="editor-section">
       <div class="editor-header">
         <div class="editor-title">üìù Code Editor</div>
         <div class="editor-controls">
           <button class="btn btn-warning" id="save-btn">üíæ Save</button>
           <button class="btn btn-success" id="publish-btn">üì§ Publish</button>
           <button class="btn btn-primary" id="run-btn">‚ñ∂Ô∏è Run</button>
         </div>
       </div>
       <textarea id="code-input" class="code-editor">// Welcome to the JavaScript Code Editor!
// Write your code here and click "Run" to see the output

console.log('Hello, World!');

// Try some examples:
// - Create variables
let name = 'Coder';
let age = 25;

// - Use template literals
console.log(`Hello, ${name}! You are ${age} years old.`);

// - Create a function
function greet(person) {
  return `Hello, ${person}!`;
}

console.log(greet('Friend'));

// - Use arrays
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(n => n * 2);
console.log('Original:', numbers);
console.log('Doubled:', doubled);

// - Game example
function createGame() {
  let score = 0;
  let lives = 3;
  
  function addPoints(points) {
    score += points;
    console.log(`Score: ${score}`);
  }
  
  function loseLife() {
    lives--;
    console.log(`Lives: ${lives}`);
    if (lives <= 0) {
      console.log('Game Over!');
    }
  }
  
  return { addPoints, loseLife, score, lives };
}

const game = createGame();
game.addPoints(100);
game.addPoints(50);
game.loseLife();</textarea>
     </div>

     <div class="output-section">
       <div class="output-header">
         <div class="editor-title">üìä Output</div>
         <div class="editor-controls">
           <button class="btn btn-danger" id="clear-btn">üóëÔ∏è Clear</button>
         </div>
       </div>
       <div id="output" class="output-content">// Output will appear here when you run your code</div>
     </div>
   </div>

   <!-- Projects Section -->
   <div class="projects-section">
     <div class="projects-title">üìö Project Library</div>
     <div class="project-tabs">
       <button class="tab-btn active" onclick="showTab('saved', event)">üíæ Saved Projects</button>
       <button class="tab-btn" onclick="showTab('published', event)">üì§ Published Projects</button>
     </div>
     
     <!-- Saved Projects Tab -->
     <div id="saved-tab" class="tab-content active">
       <div class="editor-controls" style="margin-bottom: 1rem;">
         <button class="btn btn-success" onclick="saveCurrentProject()">üíæ Save Current</button>
         <button class="btn btn-primary" onclick="loadSavedProjects()">üì• Load Saved</button>
       </div>
       <div id="saved-projects-list" class="projects-list">
         <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
           No saved projects yet. Save your first project!
         </div>
       </div>
     </div>

     <!-- Published Projects Tab -->
     <div id="published-tab" class="tab-content">
       <div class="editor-controls" style="margin-bottom: 1rem;">
         <button class="btn btn-primary" id="load-published-btn">üì• Load Published</button>
       </div>
       <div id="projects-list" class="projects-list">
         <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
           No published projects yet. Create some code and publish it!
         </div>
       </div>
     </div>
   </div>

   <!-- Save Modal -->
   <div id="save-modal" class="modal">
     <div class="modal-content">
       <div class="modal-title">üíæ Save Project</div>
       <input type="text" id="project-name" class="modal-input" placeholder="Enter project name...">
       <div class="modal-buttons">
         <button class="btn btn-danger" id="cancel-save">Cancel</button>
         <button class="btn btn-success" id="confirm-save">Save</button>
       </div>
     </div>
   </div>

  <script src="js/token-manager.js"></script>
  <script src="js/project-manager.js"></script>
  <script>
         // Block definitions
     const blockCategories = {
       events: [
         { text: 'on start', code: '// Program starts here', color: 'event', type: 'event', canNest: true },
         { text: 'on game update', code: '// Game loop', color: 'event', type: 'event', canNest: true },
         { text: 'on A button pressed', code: 'input.onButtonPressed(Button.A, () => {\n  \n});', color: 'event', type: 'event', canNest: true },
         { text: 'on B button pressed', code: 'input.onButtonPressed(Button.B, () => {\n  \n});', color: 'event', type: 'event', canNest: true }
       ],
       
       sprite: [
         { text: 'set mySprite to sprite of kind Player', code: 'let mySprite = sprites.create(img`\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n`, SpriteKind.Player);', color: 'sprite', type: 'action', canNest: false },
         { text: 'set mySprite position to x 0 y 0', code: 'mySprite.setPosition(0, 0);', color: 'sprite', type: 'action', canNest: false },
         { text: 'move mySprite by x 0 y 0', code: 'mySprite.moveBy(0, 0);', color: 'sprite', type: 'action', canNest: false },
         { text: 'turn mySprite by degrees 0', code: 'mySprite.turnBy(0);', color: 'sprite', type: 'action', canNest: false },
         { text: 'animate mySprite with fly to center for 2000ms loop OFF', code: 'mySprite.animate(AnimationKind.FlyToCenter, 2000, false);', color: 'sprite', type: 'action', canNest: false }
       ],
      
             controller: [
         { text: 'when A button pressed', code: 'input.onButtonPressed(Button.A, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when B button pressed', code: 'input.onButtonPressed(Button.B, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when up pressed', code: 'input.onButtonPressed(Button.Up, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when down pressed', code: 'input.onButtonPressed(Button.Down, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when left pressed', code: 'input.onButtonPressed(Button.Left, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'when right pressed', code: 'input.onButtonPressed(Button.Right, () => {\n  \n});', color: 'controller', type: 'event', canNest: true },
         { text: 'is A pressed', code: 'input.buttonIsPressed(Button.A)', color: 'controller', type: 'condition', canNest: false },
         { text: 'is B pressed', code: 'input.buttonIsPressed(Button.B)', color: 'controller', type: 'condition', canNest: false }
       ],
      
             game: [
         { text: 'game over WIN', code: 'game.over(true);', color: 'game', type: 'action', canNest: false },
         { text: 'game over LOSE', code: 'game.over(false);', color: 'game', type: 'action', canNest: false },
         { text: 'add score 0', code: 'info.changeScoreBy(0);', color: 'game', type: 'action', canNest: false },
         { text: 'set score to 0', code: 'info.setScore(0);', color: 'game', type: 'action', canNest: false },
         { text: 'add life 0', code: 'info.changeLifeBy(0);', color: 'game', type: 'action', canNest: false },
         { text: 'set life to 0', code: 'info.setLife(0);', color: 'game', type: 'action', canNest: false },
         { text: 'pause', code: 'game.pause();', color: 'game', type: 'action', canNest: false },
         { text: 'resume', code: 'game.resume();', color: 'game', type: 'action', canNest: false }
       ],
      
      music: [
        { text: 'play tone at 0 for 0', code: 'music.playTone(0, 0);', color: 'music' },
        { text: 'play melody', code: 'music.playMelody("", 120);', color: 'music' },
        { text: 'play melody until done', code: 'music.playMelodyUntilDone("", 120);', color: 'music' },
        { text: 'stop all sounds', code: 'music.stopAllSounds();', color: 'music' },
        { text: 'set volume 0', code: 'music.setVolume(0);', color: 'music' },
        { text: 'change volume by 0', code: 'music.changeVolumeBy(0);', color: 'music' }
      ],
      
             scene: [
         { text: 'set background image to', code: 'scene.setBackgroundImage(img`\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n. . . . . . . . . . . . . . . .\n`);', color: 'scene', type: 'action', canNest: false },
         { text: 'set background color to', code: 'scene.setBackgroundColor(0);', color: 'scene', type: 'action', canNest: false },
         { text: 'set tile to', code: 'scene.setTile();', color: 'scene', type: 'action', canNest: false },
         { text: 'set tile at x:0 y:0 to', code: 'scene.setTileAt(0, 0);', color: 'scene', type: 'action', canNest: false },
         { text: 'replace all tiles with', code: 'scene.replaceAllTiles();', color: 'scene', type: 'action', canNest: false }
       ],
      
      info: [
        { text: 'show number 0', code: 'basic.showNumber(0);', color: 'info' },
        { text: 'show string "hello"', code: 'basic.showString("hello");', color: 'info' },
        { text: 'show icon', code: 'basic.showIcon(IconNames.Heart);', color: 'info' },
        { text: 'show arrow', code: 'basic.showArrow(ArrowNames.North);', color: 'info' },
        { text: 'show leds', code: 'basic.showLeds(`\n.#.#.\n#.#.#\n.#.#.\n#.#.#\n.#.#.\n`);', color: 'info' },
        { text: 'clear screen', code: 'basic.clearScreen();', color: 'info' },
        { text: 'pause 0', code: 'basic.pause(0);', color: 'info' }
      ],
      
      loops: [
        { text: 'repeat 0 times', code: 'for (let i = 0; i < 0; i++) {\n  \n}', color: 'loops' },
        { text: 'repeat while', code: 'while (true) {\n  \n}', color: 'loops' },
        { text: 'for index from 0 to 0', code: 'for (let index = 0; index <= 0; index++) {\n  \n}', color: 'loops' },
        { text: 'for each value in list', code: 'for (let value of list) {\n  \n}', color: 'loops' }
      ],
      
      logic: [
        { text: 'if true then', code: 'if (true) {\n  \n}', color: 'logic' },
        { text: 'if true then else', code: 'if (true) {\n  \n} else {\n  \n}', color: 'logic' },
        { text: '= 0', code: '=== 0', color: 'logic' },
        { text: '< 0', code: '< 0', color: 'logic' },
        { text: '> 0', code: '> 0', color: 'logic' },
        { text: 'and', code: '&&', color: 'logic' },
        { text: 'or', code: '||', color: 'logic' },
        { text: 'not', code: '!', color: 'logic' }
      ],
      
             variables: [
         { text: 'set gfg to 0', code: 'let gfg = 0;', color: 'variables', type: 'action', canNest: false },
         { text: 'set myVariable to 0', code: 'let myVariable = 0;', color: 'variables', type: 'action', canNest: false },
         { text: 'change myVariable by 0', code: 'myVariable += 0;', color: 'variables', type: 'action', canNest: false },
         { text: 'show variable myVariable', code: 'basic.showNumber(myVariable);', color: 'variables', type: 'action', canNest: false },
         { text: 'set myVariable to "hello"', code: 'let myVariable = "hello";', color: 'variables', type: 'action', canNest: false }
       ],
      
      math: [
        { text: '0 + 0', code: '0 + 0', color: 'math' },
        { text: '0 - 0', code: '0 - 0', color: 'math' },
        { text: '0 √ó 0', code: '0 * 0', color: 'math' },
        { text: '0 √∑ 0', code: '0 / 0', color: 'math' },
        { text: 'pick random 0 to 0', code: 'Math.randomRange(0, 0)', color: 'math' },
        { text: '0 mod 0', code: '0 % 0', color: 'math' },
        { text: '0 ^ 0', code: 'Math.pow(0, 0)', color: 'math' },
        { text: '‚àö 0', code: 'Math.sqrt(0)', color: 'math' },
        { text: 'sin 0', code: 'Math.sin(0)', color: 'math' },
        { text: 'cos 0', code: 'Math.cos(0)', color: 'math' },
        { text: 'tan 0', code: 'Math.tan(0)', color: 'math' },
        { text: 'log 0', code: 'Math.log(0)', color: 'math' },
        { text: 'e ^ 0', code: 'Math.exp(0)', color: 'math' },
        { text: '10 ^ 0', code: 'Math.pow(10, 0)', color: 'math' }
      ],
      
      animation: [
        { text: 'set animation frame to 0', code: 'sprite.setAnimationFrame(0);', color: 'animation' },
        { text: 'change animation frame by 0', code: 'sprite.changeAnimationFrameBy(0);', color: 'animation' },
        { text: 'set animation frame interval to 0', code: 'sprite.setAnimationFrameInterval(0);', color: 'animation' },
        { text: 'start animation', code: 'sprite.startAnimation();', color: 'animation' },
        { text: 'stop animation', code: 'sprite.stopAnimation();', color: 'animation' }
      ],
      
      extensions: [
        { text: 'Advanced Blocks', code: '// Advanced functionality', color: 'extensions' },
        { text: 'Custom Functions', code: 'function customFunction() {\n  \n}', color: 'extensions' },
        { text: 'API Calls', code: 'fetch("https://api.example.com/data")', color: 'extensions' },
        { text: 'Local Storage', code: 'localStorage.setItem("key", "value");', color: 'extensions' }
      ]
    };

         let currentMode = 'blocks';
     let currentCategory = null;
     let workspaceBlocks = [];
     let draggedBlock = null;
     let snapTargets = [];

     // Switch between block coding and text editor
     function switchMode(mode) {
       currentMode = mode;
       
       // Update button states
       document.querySelectorAll('.mode-btn').forEach(btn => {
         btn.classList.remove('active');
       });
       event.target.classList.add('active');
       
       // Show/hide sections
       if (mode === 'blocks') {
         document.querySelector('.main-container').style.display = 'flex';
         document.querySelector('.text-editor').style.display = 'none';
       } else {
         document.querySelector('.main-container').style.display = 'none';
         document.querySelector('.text-editor').style.display = 'block';
       }
     }

     // Show blocks for a specific category
     function showBlocks(category) {
       currentCategory = category;
       const blocks = blockCategories[category] || [];
       
       // Create block selection area
       const workspace = document.getElementById('block-workspace');
       workspace.innerHTML = '';
       
       // Add category title
       const title = document.createElement('h3');
       title.textContent = category.charAt(0).toUpperCase() + category.slice(1) + ' Blocks';
       title.style.marginBottom = '1rem';
       title.style.color = '#2c3e50';
       workspace.appendChild(title);
       
       // Add blocks
       blocks.forEach(block => {
         const blockElement = document.createElement('div');
         blockElement.className = `block ${block.color}`;
         if (block.type === 'event') {
           blockElement.classList.add('event');
         }
         blockElement.textContent = block.text;
         blockElement.draggable = true;
         blockElement.dataset.block = JSON.stringify(block);
         
         blockElement.addEventListener('dragstart', (e) => {
           draggedBlock = block;
           e.dataTransfer.setData('text/plain', JSON.stringify(block));
         });
         
         blockElement.addEventListener('click', () => {
           addBlockToWorkspace(block);
         });
         
         workspace.appendChild(blockElement);
       });
     }

     // Add block to workspace
     function addBlockToWorkspace(block) {
       const workspace = document.querySelector('.workspace-content');
       
       if (block.type === 'event') {
         // Create event block with nesting container
         const eventContainer = document.createElement('div');
         eventContainer.className = 'block event ' + block.color;
         eventContainer.textContent = block.text;
         eventContainer.dataset.block = JSON.stringify(block);
         
         const nestContainer = document.createElement('div');
         nestContainer.className = 'block-container';
         nestContainer.dataset.parent = block.text;
         
         eventContainer.appendChild(nestContainer);
         workspace.appendChild(eventContainer);
         
         // Make the nest container a drop target
         makeDropTarget(nestContainer);
       } else {
         // Create regular block
         const blockElement = document.createElement('div');
         blockElement.className = `block ${block.color} nested`;
         blockElement.textContent = block.text;
         blockElement.dataset.block = JSON.stringify(block);
         blockElement.draggable = true;
         
         // Make it a drop target for other blocks
         makeDropTarget(blockElement);
         
         workspace.appendChild(blockElement);
       }
       
       workspaceBlocks.push(block);
       updateGeneratedCode();
     }

     // Make an element a drop target
     function makeDropTarget(element) {
       element.addEventListener('dragover', (e) => {
         e.preventDefault();
         element.classList.add('snap-target');
       });
       
       element.addEventListener('dragleave', () => {
         element.classList.remove('snap-target');
       });
       
       element.addEventListener('drop', (e) => {
         e.preventDefault();
         element.classList.remove('snap-target');
         
         const blockData = JSON.parse(e.dataTransfer.getData('text/plain'));
         if (blockData.type !== 'event') {
           // Add the dropped block as a nested block
           const nestedBlock = document.createElement('div');
           nestedBlock.className = `block ${blockData.color} nested`;
           nestedBlock.textContent = blockData.text;
           nestedBlock.dataset.block = JSON.stringify(blockData);
           
           element.appendChild(nestedBlock);
           workspaceBlocks.push(blockData);
           updateGeneratedCode();
         }
       });
     }

     // Update generated code from blocks
     function updateGeneratedCode() {
       let code = '// Generated code from blocks\n\n';
       
       // Find all event blocks in workspace
       const eventBlocks = document.querySelectorAll('.block.event');
       eventBlocks.forEach(eventBlock => {
         const blockData = JSON.parse(eventBlock.dataset.block);
         code += blockData.code + '\n';
         
         // Find nested blocks
         const nestedBlocks = eventBlock.querySelectorAll('.block.nested');
         nestedBlocks.forEach(nestedBlock => {
           const nestedData = JSON.parse(nestedBlock.dataset.block);
           code += '  ' + nestedData.code + '\n';
         });
         
         if (blockData.code.includes('() => {')) {
           code += '});\n';
         }
         code += '\n';
       });
       
       // Update text editor if in text mode
       const codeInput = document.getElementById('code-input');
       if (codeInput) {
         codeInput.value = code;
       }
     }

     // Filter categories
     function filterCategories(searchTerm) {
       const categories = document.querySelectorAll('.category-item');
       categories.forEach(category => {
         const text = category.querySelector('.category-text').textContent.toLowerCase();
         if (text.includes(searchTerm.toLowerCase())) {
           category.style.display = 'flex';
         } else {
           category.style.display = 'none';
         }
       });
     }

         // Initialize
     document.addEventListener('DOMContentLoaded', function() {
       // Show default category
       showBlocks('events');
       
       // Add some sample blocks to workspace
       const sampleBlocks = [
         blockCategories.events[0], // on start
         blockCategories.sprite[0], // set mySprite to sprite of kind Player
         blockCategories.sprite[1], // set mySprite position to x 0 y 0
         blockCategories.variables[0], // set gfg to 0
         blockCategories.scene[0], // set background image to
         blockCategories.events[1], // on game update
         blockCategories.game[0], // game over WIN
         blockCategories.sprite[4] // animate mySprite with fly to center
       ];
       
       // Add event blocks first
       sampleBlocks.filter(block => block.type === 'event').forEach(block => {
         addBlockToWorkspace(block);
       });
       
       // Then add action blocks to the first event block
       const firstEventBlock = document.querySelector('.block.event');
       if (firstEventBlock) {
         const nestContainer = firstEventBlock.querySelector('.block-container');
         if (nestContainer) {
           sampleBlocks.filter(block => block.type !== 'event').forEach(block => {
             const nestedBlock = document.createElement('div');
             nestedBlock.className = `block ${block.color} nested`;
             nestedBlock.textContent = block.text;
             nestedBlock.dataset.block = JSON.stringify(block);
             nestContainer.appendChild(nestedBlock);
           });
         }
       }
      
      // Initialize text editor functionality
      const runBtn = document.getElementById('run-btn');
      const output = document.getElementById('output');
      const codeInput = document.getElementById('code-input');
      const clearBtn = document.getElementById('clear-btn');
      
      if (runBtn) {
        runBtn.addEventListener('click', () => {
          try {
            const code = codeInput.value;
      const originalLog = console.log;
            let outputText = '';
            
      console.log = function(...args) {
              outputText += args.join(' ') + '\n';
        originalLog.apply(console, args);
      };
            
        eval(code);
      console.log = originalLog;
            
            output.textContent = outputText || 'Code executed successfully!';
          } catch (error) {
            output.textContent = 'Error: ' + error.message;
          }
        });
      }
      
             if (clearBtn) {
         clearBtn.addEventListener('click', () => {
           output.textContent = '// Output cleared';
         });
       }

       // Project management
       let savedProjects = JSON.parse(localStorage.getItem('codingProjects') || '[]');
       let publishedProjects = {};

       // DOM elements for projects
       const saveBtn = document.getElementById('save-btn');
       const publishBtn = document.getElementById('publish-btn');
       const loadPublishedBtn = document.getElementById('load-published-btn');
       const saveModal = document.getElementById('save-modal');
       const projectNameInput = document.getElementById('project-name');
       const confirmSaveBtn = document.getElementById('confirm-save');
       const cancelSaveBtn = document.getElementById('cancel-save');

       // Save project locally
       function saveCurrentProject() {
         const projectName = prompt('Enter a name for your project:');
         if (!projectName) return;

         const project = {
           name: projectName,
           code: codeInput.value,
           date: new Date().toISOString(),
           id: Date.now()
         };

         savedProjects.push(project);
         localStorage.setItem('codingProjects', JSON.stringify(savedProjects));
         
         alert(`Project "${projectName}" saved successfully!`);
         loadSavedProjects();
       }

       // Load saved projects from localStorage - moved to global scope
       window.loadSavedProjects = function() {
         const savedProjectsList = document.getElementById('saved-projects-list');
         
         if (savedProjects.length === 0) {
           savedProjectsList.innerHTML = `
             <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
               No saved projects yet. Save your first project!
             </div>
           `;
           return;
         }

         savedProjectsList.innerHTML = savedProjects
           .sort((a, b) => new Date(b.date) - new Date(a.date))
           .map(project => `
             <div class="project-item" onclick="loadSavedProject('${project.id}')">
               <div class="project-name">${project.name}</div>
               <div class="project-info">
                 <span class="project-date">Saved: ${new Date(project.date).toLocaleDateString()}</span>
               </div>
               <div class="project-actions">
                 <button class="btn btn-danger" onclick="deleteSavedProject('${project.id}', event)">üóëÔ∏è Delete</button>
               </div>
             </div>
           `).join('');
       }

       // Load a specific saved project - moved to global scope
       window.loadSavedProject = function(projectId) {
         const project = savedProjects.find(p => p.id == projectId);
         if (project) {
           codeInput.value = project.code;
           alert(`Loaded project: ${project.name}`);
         }
       }

       // Delete a saved project - moved to global scope
       window.deleteSavedProject = function(projectId, event) {
         event.stopPropagation();
       
         if (confirm('Are you sure you want to delete this project?')) {
           savedProjects = savedProjects.filter(p => p.id != projectId);
           localStorage.setItem('codingProjects', JSON.stringify(savedProjects));
           loadSavedProjects();
           alert('Project deleted successfully!');
         }
       }

       // Publish project to cloud
       async function publishProject() {
         const projectName = prompt('Enter a name for your published project:');
         if (!projectName) return;

         try {
           console.log('üîÑ Publishing project:', projectName);
           
           const project = {
             name: projectName,
             code: codeInput.value,
             description: 'JavaScript project',
             author: 'Anonymous',
             language: 'javascript'
           };

           const publishedProject = await window.projectManager.publishProject(project);
           console.log('üîÑ Published project response:', publishedProject);
           
           alert(`Project "${projectName}" published successfully to the cloud!`);
           
           setTimeout(() => {
             loadPublishedProjects();
           }, 1000);
         } catch (error) {
           console.error('‚ùå Error publishing project:', error);
           alert('Failed to publish project. Please try again.');
         }
       }

                       // Load published projects from cloud - moved to global scope
       window.loadPublishedProjects = async function() {
           try {
             console.log('üîÑ Starting to load published projects...');
             publishedProjects = await window.projectManager.getPublishedProjects();
             console.log('üîÑ Received projects:', publishedProjects);
             console.log('üîÑ Projects keys:', Object.keys(publishedProjects));
             console.log('üîÑ Projects values:', Object.values(publishedProjects));
           
           const projectIds = Object.keys(publishedProjects);
           
           if (projectIds.length === 0) {
             document.getElementById('projects-list').innerHTML = `
               <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
                 No published projects yet. Create some code and publish it!
               </div>
             `;
             return;
           }

           document.getElementById('projects-list').innerHTML = projectIds
             .sort((a, b) => new Date(publishedProjects[b].publishedAt) - new Date(publishedProjects[a].publishedAt))
             .map(projectId => {
               const project = publishedProjects[projectId];
               return `
                 <div class="project-item" onclick="loadProject('${projectId}')">
                   <div class="project-name">${project.name}</div>
                   <div class="project-info">
                     <span class="project-author">by ${project.author}</span>
                     <span class="project-date">Published: ${new Date(project.publishedAt).toLocaleDateString()}</span>
                   </div>
                   <div class="project-stats">
                     <span class="project-downloads">üì• ${project.downloads || 0}</span>
                     <span class="project-likes">‚ù§Ô∏è ${project.likes || 0}</span>
                   </div>
                 </div>
               `;
             }).join('');
         } catch (error) {
           console.error('‚ùå Error loading projects:', error);
           document.getElementById('projects-list').innerHTML = `
             <div style="text-align: center; color: #e74c3c; padding: 2rem;">
               Error loading projects. Please try again.
             </div>
           `;
         }
       }

       // Load a specific project from cloud - moved to global scope
       window.loadProject = async function(projectId) {
         const project = publishedProjects[projectId];
         if (project) {
           try {
             await window.projectManager.downloadProject(projectId);
             codeInput.value = project.code;
             alert(`Loaded project: ${project.name}`);
             loadPublishedProjects();
           } catch (error) {
             console.error('‚ùå Error loading project:', error);
             codeInput.value = project.code;
             alert(`Loaded project: ${project.name}`);
           }
         }
       }

       // Tab switching function - moved to global scope
       window.showTab = function(tabName, event) {
         document.querySelectorAll('.tab-content').forEach(tab => {
           tab.classList.remove('active');
         });
         
         document.querySelectorAll('.tab-btn').forEach(btn => {
           btn.classList.remove('active');
         });
         
         document.getElementById(tabName + '-tab').classList.add('active');
         if (event && event.target) {
           event.target.classList.add('active');
         }
         
         if (tabName === 'saved') {
           loadSavedProjects();
         } else if (tabName === 'published') {
           loadPublishedProjects();
         }
       }

       // Block coding save and publish functions
       function saveBlockProject() {
         const projectName = prompt('Enter a name for your block project:');
         if (!projectName) return;

         const project = {
           name: projectName,
           type: 'blocks',
           blocks: workspaceBlocks,
           generatedCode: generateCodeFromBlocks(),
           date: new Date().toISOString(),
           id: Date.now()
         };

         savedProjects.push(project);
         localStorage.setItem('codingProjects', JSON.stringify(savedProjects));
         
         alert(`Block project "${projectName}" saved successfully!`);
         loadSavedProjects();
       }

       function publishBlockProject() {
         const projectName = prompt('Enter a name for your published block project:');
         if (!projectName) return;

         try {
           console.log('üîÑ Publishing block project:', projectName);
           
           const project = {
             name: projectName,
             type: 'blocks',
             blocks: workspaceBlocks,
             code: generateCodeFromBlocks(),
             description: 'Block coding project',
             author: 'Anonymous',
             language: 'javascript'
           };

           window.projectManager.publishProject(project).then(publishedProject => {
             console.log('üîÑ Published block project response:', publishedProject);
             alert(`Block project "${projectName}" published successfully to the cloud!`);
             
             setTimeout(() => {
               loadPublishedProjects();
             }, 1000);
           }).catch(error => {
             console.error('‚ùå Error publishing block project:', error);
             alert('Failed to publish block project. Please try again.');
           });
         } catch (error) {
           console.error('‚ùå Error publishing block project:', error);
           alert('Failed to publish block project. Please try again.');
         }
       }

       function generateCodeFromBlocks() {
         // Generate JavaScript code from the visual blocks
         let code = '// Generated from block coding\n\n';
         
         workspaceBlocks.forEach(block => {
           if (block.code) {
             code += block.code + '\n';
           }
         });
         
         return code;
       }

       // Event listeners
       if (saveBtn) saveBtn.addEventListener('click', saveCurrentProject);
       if (publishBtn) publishBtn.addEventListener('click', publishProject);
       if (loadPublishedBtn) loadPublishedBtn.addEventListener('click', loadPublishedProjects);

       // Block coding event listeners
       const saveBlocksBtn = document.getElementById('save-blocks-btn');
       const publishBlocksBtn = document.getElementById('publish-blocks-btn');
       const runBlocksBtn = document.getElementById('run-blocks-btn');

       if (saveBlocksBtn) saveBlocksBtn.addEventListener('click', saveBlockProject);
       if (publishBlocksBtn) publishBlocksBtn.addEventListener('click', publishBlockProject);
       if (runBlocksBtn) runBlocksBtn.addEventListener('click', () => {
         const code = generateCodeFromBlocks();
         codeInput.value = code;
         runCode();
       });

       // Initialize projects
       loadSavedProjects();
       loadPublishedProjects();
       
       // Example functions - moved to global scope
       window.loadExample = function(exampleType) {
         const examples = {
           hello: {
             code: `// Hello World Example
console.log('Hello, World!');
console.log('Welcome to JavaScript coding!');

// Variables
let name = 'Coder';
let age = 15;

// Template literals
console.log(\`Hello, \${name}! You are \${age} years old.\`);

// Functions
function greet(person) {
  return \`Hello, \${person}!\`;
}

console.log(greet('Friend'));`,
             blocks: [
               { type: 'event', text: 'When program starts', color: 'event', code: '// Program starts here' },
               { type: 'info', text: 'Say Hello World', color: 'info', code: "console.log('Hello, World!');" },
               { type: 'variables', text: 'Create variable name', color: 'variables', code: "let name = 'Coder';" },
               { type: 'info', text: 'Say hello with name', color: 'info', code: "console.log(`Hello, ${name}!`);" }
             ]
           },
           game: {
             code: `// Simple Game Example
let score = 0;
let lives = 3;

console.log('Game started!');

function addPoints(points) {
  score += points;
  console.log(\`Score: \${score}\`);
}

function loseLife() {
  lives--;
  console.log(\`Lives: \${lives}\`);
  if (lives <= 0) {
    console.log('Game Over!');
  }
}

// Game actions
addPoints(100);
addPoints(50);
loseLife();
addPoints(25);`,
             blocks: [
               { type: 'event', text: 'When program starts', color: 'event', code: '// Game starts here' },
               { type: 'variables', text: 'Create score variable', color: 'variables', code: 'let score = 0;' },
               { type: 'variables', text: 'Create lives variable', color: 'variables', code: 'let lives = 3;' },
               { type: 'info', text: 'Display score', color: 'info', code: 'console.log(`Score: ${score}`);' },
               { type: 'logic', text: 'If lives <= 0', color: 'logic', code: 'if (lives <= 0) { console.log("Game Over!"); }' }
             ]
           },
           animation: {
             code: `// Animation Example
let position = 0;
let direction = 1;

console.log('Animation started!');

function animate() {
  position += direction;
  console.log(\`Position: \${position}\`);
  
  if (position >= 10 || position <= 0) {
    direction *= -1;
    console.log('Direction changed!');
  }
}

// Run animation
for (let i = 0; i < 5; i++) {
  animate();
}`,
             blocks: [
               { type: 'event', text: 'When program starts', color: 'event', code: '// Animation starts here' },
               { type: 'variables', text: 'Create position variable', color: 'variables', code: 'let position = 0;' },
               { type: 'loops', text: 'Repeat 5 times', color: 'loops', code: 'for (let i = 0; i < 5; i++) {' },
               { type: 'math', text: 'Add 1 to position', color: 'math', code: 'position += 1;' },
               { type: 'info', text: 'Display position', color: 'info', code: 'console.log(`Position: ${position}`);' }
             ]
           },
           math: {
             code: `// Calculator Example
function add(a, b) {
  return a + b;
}

function multiply(a, b) {
  return a * b;
}

function divide(a, b) {
  if (b === 0) {
    console.log('Error: Cannot divide by zero!');
    return null;
  }
  return a / b;
}

// Test calculations
console.log('Calculator ready!');
console.log('5 + 3 =', add(5, 3));
console.log('4 * 6 =', multiply(4, 6));
console.log('15 / 3 =', divide(15, 3));`,
             blocks: [
               { type: 'event', text: 'When program starts', color: 'event', code: '// Calculator starts here' },
               { type: 'math', text: 'Add two numbers', color: 'math', code: 'function add(a, b) { return a + b; }' },
               { type: 'math', text: 'Multiply two numbers', color: 'math', code: 'function multiply(a, b) { return a * b; }' },
               { type: 'info', text: 'Display result', color: 'info', code: 'console.log("Result:", result);' }
             ]
           }
         };

         const example = examples[exampleType];
         if (example) {
           // Clear current workspace
           document.getElementById('block-workspace').innerHTML = '';
           workspaceBlocks = [];
           
           // Add example blocks
           example.blocks.forEach(block => {
             addBlockToWorkspace(block);
           });
           
           // Update generated code
           updateGeneratedCode();
           
           alert(`Loaded ${exampleType} example!`);
         }
       };
       
       // Debug: Check if project manager is loaded
       console.log('üîç Project Manager loaded:', window.projectManager);
       console.log('üîç Token Manager loaded:', window.tokenManager);
       
       // Debug: Check if projects section exists
       const projectsSection = document.querySelector('.projects-section');
       console.log('üîç Projects section found:', projectsSection);
       
       // Debug: Check if tab buttons exist
       const tabButtons = document.querySelectorAll('.tab-btn');
       console.log('üîç Tab buttons found:', tabButtons.length);

       // Game Engine Variables
       let gameCanvas, gameCtx;
       let gameRunning = false;
       let gameScore = 0;
       let gameLives = 3;
       let joystickX = 0;
       let joystickY = 0;
       let buttonA = false;
       let buttonB = false;
       let currentTool = 'pencil';
       let currentColor = 'red';
       let isDrawing = false;
       let sprites = [];
       let gameLoop = null;

       // Initialize Game Canvas
       function initGameCanvas() {
         gameCanvas = document.getElementById('game-canvas');
         gameCtx = gameCanvas.getContext('2d');
         
         // Set up canvas for drawing
         gameCanvas.addEventListener('mousedown', startDrawing);
         gameCanvas.addEventListener('mousemove', draw);
         gameCanvas.addEventListener('mouseup', stopDrawing);
         gameCanvas.addEventListener('mouseleave', stopDrawing);
         
         // Touch events for mobile
         gameCanvas.addEventListener('touchstart', handleTouch);
         gameCanvas.addEventListener('touchmove', handleTouch);
         gameCanvas.addEventListener('touchend', stopDrawing);
         
         // Initialize joystick
         initJoystick();
         
         // Initialize buttons
         initButtons();
         
         // Start game loop
         startGameLoop();
       }

       // Joystick functionality
       function initJoystick() {
         const joystick = document.getElementById('joystick');
         const knob = document.getElementById('joystick-knob');
         
         joystick.addEventListener('mousedown', startJoystick);
         joystick.addEventListener('mousemove', moveJoystick);
         joystick.addEventListener('mouseup', stopJoystick);
         joystick.addEventListener('mouseleave', stopJoystick);
         
         // Touch events
         joystick.addEventListener('touchstart', startJoystick);
         joystick.addEventListener('touchmove', moveJoystick);
         joystick.addEventListener('touchend', stopJoystick);
         
         function startJoystick(e) {
           e.preventDefault();
           moveJoystick(e);
         }
         
         function moveJoystick(e) {
           const rect = joystick.getBoundingClientRect();
           const centerX = rect.width / 2;
           const centerY = rect.height / 2;
           
           const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
           const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
           
           const x = clientX - rect.left - centerX;
           const y = clientY - rect.top - centerY;
           
           const distance = Math.sqrt(x * x + y * y);
           const maxDistance = centerX - 15;
           
           if (distance > maxDistance) {
             const angle = Math.atan2(y, x);
             joystickX = Math.cos(angle) * maxDistance;
             joystickY = Math.sin(angle) * maxDistance;
           } else {
             joystickX = x;
             joystickY = y;
           }
           
           knob.style.transform = `translate(${joystickX}px, ${joystickY}px)`;
         }
         
         function stopJoystick() {
           joystickX = 0;
           joystickY = 0;
           knob.style.transform = 'translate(-50%, -50%)';
         }
       }

       // Button functionality
       function initButtons() {
         const btnA = document.getElementById('btn-a');
         const btnB = document.getElementById('btn-b');
         
         btnA.addEventListener('mousedown', () => { buttonA = true; });
         btnA.addEventListener('mouseup', () => { buttonA = false; });
         btnA.addEventListener('touchstart', (e) => { e.preventDefault(); buttonA = true; });
         btnA.addEventListener('touchend', () => { buttonA = false; });
         
         btnB.addEventListener('mousedown', () => { buttonB = true; });
         btnB.addEventListener('mouseup', () => { buttonB = false; });
         btnB.addEventListener('touchstart', (e) => { e.preventDefault(); buttonB = true; });
         btnB.addEventListener('touchend', () => { buttonB = false; });
       }

       // Drawing functionality
       function selectTool(tool) {
         currentTool = tool;
         document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
         event.target.classList.add('active');
       }

       function selectColor(color) {
         currentColor = color;
         document.querySelectorAll('.color-swatch').forEach(swatch => swatch.style.border = '2px solid rgba(255, 255, 255, 0.3)');
         event.target.style.border = '2px solid #fff';
       }

       function startDrawing(e) {
         isDrawing = true;
         draw(e);
       }

       function draw(e) {
         if (!isDrawing) return;
         
         const rect = gameCanvas.getBoundingClientRect();
         const x = e.clientX - rect.left;
         const y = e.clientY - rect.top;
         
         gameCtx.lineWidth = 2;
         gameCtx.lineCap = 'round';
         gameCtx.strokeStyle = currentColor;
         
         if (currentTool === 'pencil') {
           gameCtx.lineTo(x, y);
           gameCtx.stroke();
           gameCtx.beginPath();
           gameCtx.moveTo(x, y);
         } else if (currentTool === 'square') {
           gameCtx.fillStyle = currentColor;
           gameCtx.fillRect(x - 10, y - 10, 20, 20);
         } else if (currentTool === 'circle') {
           gameCtx.fillStyle = currentColor;
           gameCtx.beginPath();
           gameCtx.arc(x, y, 10, 0, 2 * Math.PI);
           gameCtx.fill();
         }
       }

       function stopDrawing() {
         isDrawing = false;
         gameCtx.beginPath();
       }

       function handleTouch(e) {
         e.preventDefault();
         const touch = e.touches[0];
         const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
           clientX: touch.clientX,
           clientY: touch.clientY
         });
         gameCanvas.dispatchEvent(mouseEvent);
       }

       // Category rollout functionality
       window.toggleCategory = function(categoryName) {
         console.log('üîÑ Toggle category:', categoryName);
         
         const categoryItem = event.target.closest('.category-item');
         const categoryBlocks = document.getElementById(categoryName + '-blocks');
         
         console.log('üîÑ Category item found:', categoryItem);
         console.log('üîÑ Category blocks found:', categoryBlocks);
         
         if (!categoryBlocks) {
           console.error('‚ùå Category blocks not found for:', categoryName);
           return;
         }
         
         if (categoryBlocks.style.display === 'none') {
           console.log('üîÑ Opening category:', categoryName);
           
           // Close all other categories
           document.querySelectorAll('.category-blocks').forEach(blocks => {
             blocks.style.display = 'none';
           });
           document.querySelectorAll('.category-item').forEach(item => {
             item.classList.remove('expanded');
           });
           
           // Open this category
           categoryBlocks.style.display = 'block';
           categoryItem.classList.add('expanded');
           
           console.log('‚úÖ Category opened successfully');
         } else {
           console.log('üîÑ Closing category:', categoryName);
           
           // Close this category
           categoryBlocks.style.display = 'none';
           categoryItem.classList.remove('expanded');
           
           console.log('‚úÖ Category closed successfully');
         }
       }

       // Drag and drop functionality
       function initDragAndDrop() {
         document.querySelectorAll('.block-item').forEach(item => {
           item.addEventListener('dragstart', handleDragStart);
         });
         
         const workspace = document.getElementById('block-workspace');
         workspace.addEventListener('dragover', handleDragOver);
         workspace.addEventListener('drop', handleDrop);
       }

       function handleDragStart(e) {
         e.dataTransfer.setData('text/plain', e.target.dataset.block);
       }

       function handleDragOver(e) {
         e.preventDefault();
       }

       function handleDrop(e) {
         e.preventDefault();
         const blockData = JSON.parse(e.dataTransfer.getData('text/plain'));
         addBlockToWorkspace(blockData);
       }

       // Game loop
       function startGameLoop() {
         gameRunning = true;
         gameLoop = setInterval(() => {
           updateGame();
           renderGame();
         }, 1000 / 60); // 60 FPS
       }

       function updateGame() {
         // Update sprites based on joystick input
         sprites.forEach(sprite => {
           if (joystickX !== 0 || joystickY !== 0) {
             sprite.x += joystickX * 0.1;
             sprite.y += joystickY * 0.1;
           }
         });
         
         // Update score display
         document.getElementById('game-score').textContent = `Score: ${gameScore}`;
         document.getElementById('game-lives').textContent = `Lives: ${gameLives}`;
       }

       function renderGame() {
         // Clear canvas
         gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
         
         // Draw sprites
         sprites.forEach(sprite => {
           gameCtx.fillStyle = sprite.color;
           gameCtx.fillRect(sprite.x, sprite.y, sprite.width, sprite.height);
         });
       }

       // Game control functions
       window.toggleGameMenu = function() {
         alert('Game Menu - Coming Soon!');
       }

       window.resetGame = function() {
         gameScore = 0;
         gameLives = 3;
         sprites = [];
         gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
       }

       window.toggleSound = function() {
         alert('Sound Toggle - Coming Soon!');
       }

       window.toggleFullscreen = function() {
         alert('Fullscreen - Coming Soon!');
       }

       window.takeScreenshot = function() {
         const link = document.createElement('a');
         link.download = 'game-screenshot.png';
         link.href = gameCanvas.toDataURL();
         link.click();
       }

       window.toggleDebug = function() {
         console.log('Game State:', {
           score: gameScore,
           lives: gameLives,
           joystick: { x: joystickX, y: joystickY },
           buttons: { A: buttonA, B: buttonB },
           sprites: sprites.length
         });
       }

       // Initialize everything
       initGameCanvas();
       initDragAndDrop();
     });
  </script>
</body>
</html> 
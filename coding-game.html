<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Studio - Professional Development Environment</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header h1 {
      color: #2c3e50;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .header p {
      color: #7f8c8d;
      font-size: 1rem;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2rem;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      min-height: calc(100vh - 120px);
    }
    
    .mode-switcher {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
    }
    
    .mode-btn {
      padding: 0.75rem 1.5rem;
      border: 2px solid #3498db;
      background: transparent;
      color: #3498db;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .mode-btn.active {
      background: #3498db;
      color: white;
    }
    
    .mode-btn:hover {
      background: #3498db;
      color: white;
      transform: translateY(-2px);
    }

    .editor-section {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .editor-header {
      background: #2c3e50;
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .editor-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .editor-controls {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: #3498db;
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
      transform: translateY(-1px);
    }
    
    .block-coding {
      display: none;
    }
    
    .block-coding.active {
      display: block;
    }
    
    .blocks-container {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .block-category {
      margin-bottom: 1rem;
    }
    
    .block-category h3 {
      color: #2c3e50;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      border-bottom: 2px solid #3498db;
      padding-bottom: 0.25rem;
    }
    
    .block {
      display: inline-block;
      padding: 0.5rem 1rem;
      margin: 0.25rem;
      background: #3498db;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      user-select: none;
    }
    
    .block:hover {
      background: #2980b9;
      transform: translateY(-1px);
    }
    
    .block.logic {
      background: #e74c3c;
    }
    
    .block.logic:hover {
      background: #c0392b;
    }
    
    .block.loop {
      background: #f39c12;
    }
    
    .block.loop:hover {
      background: #e67e22;
    }
    
    .block.function {
      background: #9b59b6;
    }
    
    .block.function:hover {
      background: #8e44ad;
    }
    
    .block.variable {
      background: #27ae60;
    }
    
    .block.variable:hover {
      background: #229954;
    }
    
    .block.output {
      background: #34495e;
    }
    
    .block.output:hover {
      background: #2c3e50;
    }
    
    .code-workspace {
      background: #fff;
      border: 2px dashed #bdc3c7;
      border-radius: 8px;
      min-height: 200px;
      padding: 1rem;
      margin-top: 1rem;
    }
    
    .code-workspace.dragover {
      border-color: #3498db;
      background: #ecf0f1;
    }
    
    .generated-code {
      background: #2c3e50;
      color: #ecf0f1;
      border-radius: 8px;
      padding: 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      line-height: 1.4;
      margin-top: 1rem;
      max-height: 200px;
      overflow-y: auto;
    }

    .btn-success {
      background: #27ae60;
      color: white;
    }

    .btn-success:hover {
      background: #229954;
      transform: translateY(-1px);
    }

    .btn-warning {
      background: #f39c12;
      color: white;
    }

    .btn-warning:hover {
      background: #e67e22;
      transform: translateY(-1px);
    }

    .btn-danger {
      background: #e74c3c;
      color: white;
    }

    .btn-danger:hover {
      background: #c0392b;
      transform: translateY(-1px);
    }

    .code-editor {
      width: 100%;
      height: 400px;
      font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.5;
      padding: 1rem;
      border: none;
      resize: vertical;
      background: #1e1e1e;
      color: #d4d4d4;
      outline: none;
    }

    .output-section {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .output-header {
      background: #27ae60;
      color: white;
      padding: 1rem 1.5rem;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .output-content {
      padding: 1rem;
      min-height: 400px;
      background: #1e1e1e;
      color: #d4d4d4;
      font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
      overflow-y: auto;
    }

    .examples-section {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .examples-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #2c3e50;
    }

    .examples-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .example-card {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .example-card:hover {
      border-color: #3498db;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
    }

    .example-title {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }

    .example-desc {
      color: #7f8c8d;
      font-size: 0.9rem;
    }

    .projects-section {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .projects-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #2c3e50;
    }

    .projects-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .project-item {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 6px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .project-item:hover {
      background: #e9ecef;
      transform: translateX(4px);
    }

    .project-name {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 0.25rem;
    }

    .project-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 0.5rem 0;
      font-size: 0.8rem;
      color: #7f8c8d;
    }
    
    .project-author {
      font-weight: 500;
      color: #3498db;
    }
    
    .project-date {
      color: #7f8c8d;
      font-size: 0.8rem;
    }
    
    .project-stats {
      display: flex;
      gap: 1rem;
      font-size: 0.8rem;
      color: #7f8c8d;
    }
    
    .project-downloads,
    .project-likes {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .project-actions {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
    }

    .project-actions .btn {
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
    }

    .project-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      border-bottom: 2px solid #e9ecef;
    }

    .tab-btn {
      padding: 0.75rem 1.5rem;
      background: #f8f9fa;
      border: none;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      color: #6c757d;
    }

    .tab-btn.active {
      background: #007bff;
      color: white;
    }

    .tab-btn:hover:not(.active) {
      background: #e9ecef;
      color: #495057;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      max-width: 500px;
      margin: 10vh auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #2c3e50;
    }

    .modal-input {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .modal-input:focus {
      outline: none;
      border-color: #3498db;
    }

    .modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .back-link {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.75rem 1.5rem;
      background: #34495e;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .back-link:hover {
      background: #2c3e50;
      transform: translateY(-1px);
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
        padding: 1rem;
      }
      
      .header {
        padding: 1rem;
      }
      
      .header h1 {
        font-size: 1.5rem;
      }
      
      .code-editor {
        height: 300px;
      }
      
      .output-content {
        min-height: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>🚀 Code Studio - Professional Development Environment</h1>
    <p>Write, run, and share your JavaScript code with text editor or block coding!</p>
  </div>

  <div class="mode-switcher">
    <button class="mode-btn active" onclick="switchMode('text')">📝 Text Editor</button>
    <button class="mode-btn" onclick="switchMode('blocks')">🧱 Block Coding</button>
  </div>

  <div class="container">
    <div class="editor-section text-editor active">
      <div class="editor-header">
        <div class="editor-title">📝 Code Editor</div>
        <div class="editor-controls">
          <button class="btn btn-warning" id="save-btn">💾 Save</button>
          <button class="btn btn-success" id="publish-btn">📤 Publish</button>
          <button class="btn btn-primary" id="run-btn">▶️ Run</button>
        </div>
      </div>
      <textarea id="code-input" class="code-editor">// Welcome to the JavaScript Code Editor!
// Write your code here and click "Run" to see the output

console.log('Hello, World!');

// Try some examples:
// - Create variables
let name = 'Coder';
let age = 25;

// - Use template literals
console.log(`Hello, ${name}! You are ${age} years old.`);

// - Create a function
function greet(person) {
  return `Hello, ${person}!`;
}

console.log(greet('Friend'));

// - Use arrays
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(n => n * 2);
console.log('Original:', numbers);
console.log('Doubled:', doubled);</textarea>
    </div>
    
    <div class="editor-section block-coding">
      <div class="editor-header">
        <div class="editor-title">🧱 Block Coding Studio</div>
        <div class="editor-controls">
          <button class="btn btn-primary" onclick="generateCode()">🔧 Generate Code</button>
          <button class="btn btn-success" onclick="saveBlockProject()">💾 Save</button>
          <button class="btn btn-primary" onclick="publishBlockProject()">📤 Publish</button>
        </div>
      </div>
      
      <div class="blocks-container">
        <div class="block-category">
          <h3>Output</h3>
          <div class="block output" draggable="true" data-block="console.log('Hello World');">console.log</div>
          <div class="block output" draggable="true" data-block="alert('Message');">alert</div>
          <div class="block output" draggable="true" data-block="document.write('Text');">document.write</div>
        </div>
        
        <div class="block-category">
          <h3>Variables</h3>
          <div class="block variable" draggable="true" data-block="let name = 'value';" data-input="name">let variable</div>
          <div class="block variable" draggable="true" data-block="const PI = 3.14;" data-input="PI">const variable</div>
          <div class="block variable" draggable="true" data-block="var oldVar = 'value';" data-input="oldVar">var variable</div>
        </div>
        
        <div class="block-category">
          <h3>Logic</h3>
          <div class="block logic" draggable="true" data-block="if (condition) {&#10;  // code&#10;}">if statement</div>
          <div class="block logic" draggable="true" data-block="if (condition) {&#10;  // code&#10;} else {&#10;  // code&#10;}">if-else</div>
          <div class="block logic" draggable="true" data-block="switch(value) {&#10;  case 1:&#10;    break;&#10;  default:&#10;    break;&#10;}">switch</div>
        </div>
        
        <div class="block-category">
          <h3>Loops</h3>
          <div class="block loop" draggable="true" data-block="for (let i = 0; i < 10; i++) {&#10;  // code&#10;}">for loop</div>
          <div class="block loop" draggable="true" data-block="while (condition) {&#10;  // code&#10;}">while loop</div>
          <div class="block loop" draggable="true" data-block="do {&#10;  // code&#10;} while (condition);">do-while</div>
        </div>
        
        <div class="block-category">
          <h3>Functions</h3>
          <div class="block function" draggable="true" data-block="function myFunction() {&#10;  // code&#10;}">function</div>
          <div class="block function" draggable="true" data-block="const myFunction = () => {&#10;  // code&#10;};">arrow function</div>
          <div class="block function" draggable="true" data-block="return value;">return</div>
        </div>
      </div>
      
      <div class="code-workspace" id="code-workspace">
        <p style="color: #7f8c8d; text-align: center; margin-top: 2rem;">Drag blocks here to build your code!</p>
      </div>
      
      <div class="generated-code" id="generated-code" style="display: none;">
        <strong>Generated JavaScript Code:</strong>
        <pre id="code-output"></pre>
      </div>
    </div>

    <div class="output-section">
      <div class="editor-header">
        <div class="editor-title">📊 Output</div>
        <div class="editor-controls">
          <button class="btn btn-danger" id="clear-btn">🗑️ Clear</button>
        </div>
      </div>
      <div id="output" class="output-content">// Output will appear here when you run your code</div>
    </div>
  </div>

  <div class="examples-section">
    <div class="examples-title">💡 Code Examples</div>
    <div class="examples-grid">
      <div class="example-card" data-example="hello">
        <div class="example-title">Hello World</div>
        <div class="example-desc">Basic console output</div>
      </div>
      <div class="example-card" data-example="variables">
        <div class="example-title">Variables & Types</div>
        <div class="example-desc">Working with different data types</div>
      </div>
      <div class="example-card" data-example="functions">
        <div class="example-title">Functions</div>
        <div class="example-desc">Creating and using functions</div>
      </div>
      <div class="example-card" data-example="arrays">
        <div class="example-title">Arrays & Loops</div>
        <div class="example-desc">Working with arrays and loops</div>
      </div>
      <div class="example-card" data-example="objects">
        <div class="example-title">Objects</div>
        <div class="example-desc">Creating and using objects</div>
      </div>
      <div class="example-card" data-example="async">
        <div class="example-title">Async/Await</div>
        <div class="example-desc">Working with promises</div>
      </div>
    </div>
  </div>

  <div class="projects-section">
    <div class="projects-title">📚 Project Library</div>
    <div class="project-tabs">
      <button class="tab-btn active" onclick="showTab('saved')">💾 Saved Projects</button>
      <button class="tab-btn" onclick="showTab('published')">📤 Published Projects</button>
    </div>
    
    <!-- Saved Projects Tab -->
    <div id="saved-tab" class="tab-content active">
      <div class="editor-controls" style="margin-bottom: 1rem;">
        <button class="btn btn-success" onclick="saveCurrentProject()">💾 Save Current</button>
        <button class="btn btn-primary" onclick="loadSavedProjects()">📥 Load Saved</button>
      </div>
      <div id="saved-projects-list" class="projects-list">
        <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
          No saved projects yet. Save your first project!
        </div>
      </div>
    </div>
    
    <!-- Published Projects Tab -->
    <div id="published-tab" class="tab-content">
      <div class="editor-controls" style="margin-bottom: 1rem;">
        <button class="btn btn-primary" id="load-published-btn">📥 Load Published</button>
      </div>
      <div id="projects-list" class="projects-list">
        <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
          No published projects yet. Create some code and publish it!
        </div>
      </div>
    </div>
  </div>

  <!-- Save Modal -->
  <div id="save-modal" class="modal">
    <div class="modal-content">
      <div class="modal-title">💾 Save Project</div>
      <input type="text" id="project-name" class="modal-input" placeholder="Enter project name...">
      <div class="modal-buttons">
        <button class="btn btn-danger" id="cancel-save">Cancel</button>
        <button class="btn btn-success" id="confirm-save">Save</button>
      </div>
    </div>
  </div>

  <div style="text-align: center; padding: 2rem;">
    <a href="index.html" class="back-link">🏠 Back to Home</a>
  </div>

  <script src="js/project-manager.js"></script>
  <script>
    // Code examples
    const examples = {
      hello: `// Hello World Example
console.log('Hello, World!');
console.log('Welcome to JavaScript!');`,

      variables: `// Variables and Data Types
let name = 'Alice';
const age = 25;
const isStudent = true;
const hobbies = ['reading', 'coding', 'gaming'];

console.log('Name:', name);
console.log('Age:', age);
console.log('Is Student:', isStudent);
console.log('Hobbies:', hobbies);

// Template literals
console.log(\`\${name} is \${age} years old\`);`,

      functions: `// Functions Example
function greet(name) {
  return \`Hello, \${name}!\`;
}

const add = (a, b) => a + b;

function factorial(n) {
  if (n <= 1) return 1;
  return n * factorial(n - 1);
}

console.log(greet('World'));
console.log('Sum:', add(5, 3));
console.log('Factorial of 5:', factorial(5));`,

      arrays: `// Arrays and Loops
const numbers = [1, 2, 3, 4, 5];
const fruits = ['apple', 'banana', 'orange'];

// For loop
console.log('Numbers:');
for (let i = 0; i < numbers.length; i++) {
  console.log(numbers[i]);
}

// ForEach
console.log('\\nFruits:');
fruits.forEach(fruit => console.log(fruit));

// Map
const doubled = numbers.map(n => n * 2);
console.log('\\nDoubled numbers:', doubled);

// Filter
const evenNumbers = numbers.filter(n => n % 2 === 0);
console.log('Even numbers:', evenNumbers);`,

      objects: `// Objects Example
const person = {
  name: 'John',
  age: 30,
  city: 'New York',
  hobbies: ['coding', 'music'],
  greet() {
    return \`Hello, I'm \${this.name}\`;
  }
};

console.log('Person:', person);
console.log('Name:', person.name);
console.log('Greeting:', person.greet());

// Destructuring
const { name, age, city } = person;
console.log(\`\${name} is \${age} years old from \${city}\`);`,

      async: `// Async/Await Example
function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function fetchData() {
  console.log('Fetching data...');
  await delay(1000);
  return { id: 1, name: 'Sample Data' };
}

async function main() {
  try {
    const data = await fetchData();
    console.log('Data received:', data);
  } catch (error) {
    console.error('Error:', error);
  }
}

main();`
    };

    // Project storage - now using cloud-based storage
    let savedProjects = JSON.parse(localStorage.getItem('codingProjects') || '[]');
    let publishedProjects = {}; // Will be loaded from cloud

    // DOM elements
    const codeInput = document.getElementById('code-input');
    const output = document.getElementById('output');
    const runBtn = document.getElementById('run-btn');
    const saveBtn = document.getElementById('save-btn');
    const publishBtn = document.getElementById('publish-btn');
    const loadPublishedBtn = document.getElementById('load-published-btn');
    const clearBtn = document.getElementById('clear-btn');
    const saveModal = document.getElementById('save-modal');
    const projectNameInput = document.getElementById('project-name');
    const confirmSaveBtn = document.getElementById('confirm-save');
    const cancelSaveBtn = document.getElementById('cancel-save');
    const projectsList = document.getElementById('projects-list');

    // Run code
    function runCode() {
      const code = codeInput.value;
      let outputText = '';
      
      // Capture console.log
      const originalLog = console.log;
      const originalError = console.error;
      
      console.log = function(...args) {
        outputText += args.map(arg => 
          typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
        ).join(' ') + '\n';
        originalLog.apply(console, args);
      };
      
      console.error = function(...args) {
        outputText += '❌ ERROR: ' + args.map(arg => 
          typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
        ).join(' ') + '\n';
        originalError.apply(console, args);
      };

      try {
        // Create a safe execution environment
        const safeEval = new Function(code);
        safeEval();
      } catch (error) {
        outputText += '❌ ERROR: ' + error.message + '\n';
      }

      // Restore original console methods
      console.log = originalLog;
      console.error = originalError;

      output.textContent = outputText || '// No output generated';
    }

    // Save project locally
    function saveProject() {
      const projectName = projectNameInput.value.trim();
      if (!projectName) {
        alert('Please enter a project name!');
        return;
      }

      const project = {
        name: projectName,
        code: codeInput.value,
        date: new Date().toISOString(),
        id: Date.now()
      };

      savedProjects.push(project);
      localStorage.setItem('codingProjects', JSON.stringify(savedProjects));
      
      saveModal.style.display = 'none';
      projectNameInput.value = '';
      
      alert(`Project "${projectName}" saved successfully!`);
    }

    // Publish project to cloud
    async function publishProject() {
      const projectName = prompt('Enter a name for your published project:');
      if (!projectName) return;

      try {
        console.log('🔄 Publishing project:', projectName);
        console.log('🔄 Project code length:', codeInput.value.length);
        
        const project = {
          name: projectName,
          code: codeInput.value,
          description: 'JavaScript project',
          author: 'Anonymous', // In a real app, this would be the user's name
          language: 'javascript'
        };

        console.log('🔄 Project object:', project);
        const publishedProject = await window.projectManager.publishProject(project);
        console.log('🔄 Published project response:', publishedProject);
        
        alert(`Project "${projectName}" published successfully to the cloud!`);
        
        // Wait a moment then refresh the list
        setTimeout(() => {
          loadPublishedProjects();
        }, 1000);
      } catch (error) {
        console.error('❌ Error publishing project:', error);
        alert('Failed to publish project. Please try again.');
      }
    }

    // Load published projects from cloud
    async function loadPublishedProjects() {
      try {
        console.log('🔄 Starting to load published projects...');
        publishedProjects = await window.projectManager.getPublishedProjects();
        console.log('🔄 Received projects:', publishedProjects);
        
        const projectIds = Object.keys(publishedProjects);
        console.log('🔄 Project IDs:', projectIds);
        console.log('🔄 Number of projects:', projectIds.length);
        
        if (projectIds.length === 0) {
          console.log('🔄 No projects found, showing empty message');
          projectsList.innerHTML = `
            <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
              No published projects yet. Create some code and publish it!
            </div>
          `;
          return;
        }

        projectsList.innerHTML = projectIds
          .sort((a, b) => new Date(publishedProjects[b].publishedAt) - new Date(publishedProjects[a].publishedAt))
          .map(projectId => {
            const project = publishedProjects[projectId];
            return `
              <div class="project-item" onclick="loadProject('${projectId}')">
                <div class="project-name">${project.name}</div>
                <div class="project-info">
                  <span class="project-author">by ${project.author}</span>
                  <span class="project-date">Published: ${new Date(project.publishedAt).toLocaleDateString()}</span>
                </div>
                <div class="project-stats">
                  <span class="project-downloads">📥 ${project.downloads || 0}</span>
                  <span class="project-likes">❤️ ${project.likes || 0}</span>
                </div>
              </div>
            `;
          }).join('');
      } catch (error) {
        console.error('❌ Error loading projects:', error);
        projectsList.innerHTML = `
          <div style="text-align: center; color: #e74c3c; padding: 2rem;">
            Error loading projects. Please try again.
          </div>
        `;
      }
    }

    // Load a specific project from cloud
    async function loadProject(projectId) {
      const project = publishedProjects[projectId];
      if (project) {
        try {
          // Track download
          await window.projectManager.downloadProject(projectId);
          
          // Load the code
          codeInput.value = project.code;
          alert(`Loaded project: ${project.name}`);
          
          // Refresh the list to show updated download count
          loadPublishedProjects();
        } catch (error) {
          console.error('❌ Error loading project:', error);
          // Still load the project even if tracking fails
          codeInput.value = project.code;
          alert(`Loaded project: ${project.name}`);
        }
      }
    }

    // Clear output
    function clearOutput() {
      output.textContent = '// Output cleared';
    }

    // Event listeners
    runBtn.addEventListener('click', runCode);
    saveBtn.addEventListener('click', () => saveModal.style.display = 'block');
    publishBtn.addEventListener('click', publishProject);
    loadPublishedBtn.addEventListener('click', loadPublishedProjects);
    clearBtn.addEventListener('click', clearOutput);
    
    confirmSaveBtn.addEventListener('click', saveProject);
    cancelSaveBtn.addEventListener('click', () => {
      saveModal.style.display = 'none';
      projectNameInput.value = '';
    });

    // Close modal when clicking outside
    saveModal.addEventListener('click', (e) => {
      if (e.target === saveModal) {
        saveModal.style.display = 'none';
        projectNameInput.value = '';
      }
    });

    // Example cards
    document.querySelectorAll('.example-card').forEach(card => {
      card.addEventListener('click', () => {
        const example = card.dataset.example;
        if (examples[example]) {
          codeInput.value = examples[example];
        }
      });
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'Enter':
            e.preventDefault();
            runCode();
            break;
          case 's':
            e.preventDefault();
            saveModal.style.display = 'block';
            break;
        }
      }
    });

    // Tab switching function
    function showTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(tabName + '-tab').classList.add('active');
      
      // Add active class to clicked button
      event.target.classList.add('active');
      
      // Load appropriate projects
      if (tabName === 'saved') {
        loadSavedProjects();
      } else if (tabName === 'published') {
        loadPublishedProjects();
      }
    }

    // Block coding functionality
    let currentMode = 'text';
    let blockCode = [];

    // Switch between text editor and block coding
    function switchMode(mode) {
      currentMode = mode;
      
      // Update button states
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Show/hide sections
      document.querySelectorAll('.editor-section').forEach(section => {
        section.style.display = 'none';
      });
      
      if (mode === 'text') {
        document.querySelector('.text-editor').style.display = 'block';
      } else {
        document.querySelector('.block-coding').style.display = 'block';
      }
    }

    // Initialize drag and drop for blocks
    function initBlockCoding() {
      const blocks = document.querySelectorAll('.block');
      const workspace = document.getElementById('code-workspace');
      
      blocks.forEach(block => {
        block.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', block.dataset.block);
          e.dataTransfer.setData('text/html', block.outerHTML);
        });
      });
      
      workspace.addEventListener('dragover', (e) => {
        e.preventDefault();
        workspace.classList.add('dragover');
      });
      
      workspace.addEventListener('dragleave', () => {
        workspace.classList.remove('dragover');
      });
      
      workspace.addEventListener('drop', (e) => {
        e.preventDefault();
        workspace.classList.remove('dragover');
        
        const blockCode = e.dataTransfer.getData('text/plain');
        const blockHTML = e.dataTransfer.getData('text/html');
        
        // Create a new block in the workspace
        const newBlock = document.createElement('div');
        newBlock.className = 'block';
        newBlock.innerHTML = blockHTML;
        newBlock.style.margin = '0.5rem';
        newBlock.style.cursor = 'pointer';
        newBlock.onclick = () => newBlock.remove();
        
        workspace.appendChild(newBlock);
        
        // Store the code
        blockCode.push(blockCode);
      });
    }

    // Generate JavaScript code from blocks
    function generateCode() {
      const workspace = document.getElementById('code-workspace');
      const blocks = workspace.querySelectorAll('.block');
      let generatedCode = '';
      
      blocks.forEach(block => {
        const code = block.dataset.block;
        if (code) {
          generatedCode += code + '\n';
        }
      });
      
      if (generatedCode.trim()) {
        document.getElementById('code-output').textContent = generatedCode;
        document.getElementById('generated-code').style.display = 'block';
        
        // Also update the text editor
        document.getElementById('code-input').value = generatedCode;
      } else {
        alert('No blocks in workspace!');
      }
    }

    // Save block project
    function saveBlockProject() {
      const projectName = prompt('Enter a name for your block project:');
      if (!projectName) return;

      const project = {
        name: projectName,
        code: document.getElementById('code-input').value,
        date: new Date().toISOString(),
        id: Date.now(),
        type: 'block'
      };

      const savedProjects = JSON.parse(localStorage.getItem('savedProjects') || '[]');
      savedProjects.push(project);
      localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
      
      alert('Block project saved!');
    }

    // Publish block project
    async function publishBlockProject() {
      const projectName = prompt('Enter a name for your block project:');
      if (!projectName) return;

      const projectDescription = prompt('Enter a description for your project:');
      if (!projectDescription) return;

      try {
        const project = {
          name: projectName,
          description: projectDescription,
          code: document.getElementById('code-input').value,
          language: 'javascript',
          author: 'Block Coder',
          publishedAt: new Date().toISOString(),
          downloads: 0,
          likes: 0
        };

        await window.projectManager.publishProject(project);
        alert('Block project published successfully!');
      } catch (error) {
        console.error('❌ Error publishing block project:', error);
        alert('Failed to publish project. Please try again.');
      }
    }

    // Save current project locally
    function saveCurrentProject() {
      const projectName = prompt('Enter a name for your project:');
      if (!projectName) return;

      const project = {
        name: projectName,
        code: codeInput.value,
        date: new Date().toISOString(),
        id: Date.now()
      };

      savedProjects.push(project);
      localStorage.setItem('codingProjects', JSON.stringify(savedProjects));
      
      alert(`Project "${projectName}" saved successfully!`);
      loadSavedProjects();
    }

    // Load saved projects from localStorage
    function loadSavedProjects() {
      const savedProjectsList = document.getElementById('saved-projects-list');
      
      if (savedProjects.length === 0) {
        savedProjectsList.innerHTML = `
          <div style="text-align: center; color: #7f8c8d; padding: 2rem;">
            No saved projects yet. Save your first project!
          </div>
        `;
        return;
      }

      savedProjectsList.innerHTML = savedProjects
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .map(project => `
          <div class="project-item" onclick="loadSavedProject('${project.id}')">
            <div class="project-name">${project.name}</div>
            <div class="project-info">
              <span class="project-date">Saved: ${new Date(project.date).toLocaleDateString()}</span>
            </div>
            <div class="project-actions">
              <button class="btn btn-danger" onclick="deleteSavedProject('${project.id}', event)">🗑️ Delete</button>
            </div>
          </div>
        `).join('');
    }

    // Load a specific saved project
    function loadSavedProject(projectId) {
      const project = savedProjects.find(p => p.id == projectId);
      if (project) {
        codeInput.value = project.code;
        alert(`Loaded project: ${project.name}`);
      }
    }

    // Delete a saved project
    function deleteSavedProject(projectId, event) {
      event.stopPropagation(); // Prevent loading the project when clicking delete
    
      if (confirm('Are you sure you want to delete this project?')) {
        savedProjects = savedProjects.filter(p => p.id != projectId);
        localStorage.setItem('codingProjects', JSON.stringify(savedProjects));
        loadSavedProjects();
        alert('Project deleted successfully!');
      }
    }

    // Initialize
    loadSavedProjects();
    loadPublishedProjects();
    initBlockCoding();
  </script>
</body>
</html> 
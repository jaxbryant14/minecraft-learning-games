<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arcade Games</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0; 
      padding: 0; 
      min-height: 100vh;
    }
    .container { 
      max-width: 600px; 
      margin: 40px auto; 
      background: #fff; 
      padding: 2.5em; 
      border-radius: 16px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      text-align: center;
    }
    h2 { 
      text-align: center; 
      color: #333;
      margin-bottom: 1.5em;
      font-size: 2.2em;
    }
    .token-info { 
      text-align: center; 
      margin-bottom: 1.5em;
      font-size: 1.2em;
      font-weight: bold;
      color: #1976d2;
    }
    .user-email { 
      text-align: center; 
      margin-bottom: 1em;
      color: #666;
      font-style: italic;
    }
    .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 2em 0;
    }
    .game-card {
      background: linear-gradient(45deg, #f8f9fa, #e9ecef);
      border-radius: 12px;
      padding: 1.5em;
      border: 2px solid #e0e0e0;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }
    .game-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border-color: #1976d2;
    }
    .game-card.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .game-title {
      font-size: 1.3em;
      font-weight: bold;
      color: #333;
      margin-bottom: 0.5em;
    }
    .game-description {
      color: #666;
      margin-bottom: 1em;
      font-size: 0.9em;
    }
    .game-cost {
      color: #1976d2;
      font-weight: bold;
      font-size: 1.1em;
    }
    .back-link { 
      display: block; 
      text-align: center; 
      margin-top: 2em;
      color: #1976d2;
      text-decoration: none;
      font-weight: bold;
    }
    .back-link:hover {
      text-decoration: underline;
    }
    .game-area {
      display: none;
      margin-top: 2em;
    }
    .game-area.active {
      display: block;
    }
    .game-canvas {
      border: 2px solid #333;
      border-radius: 8px;
      background: #000;
      margin: 1em auto;
    }
    .game-controls {
      margin: 1em 0;
    }
    button { 
      padding: 0.8em 1.5em; 
      background: linear-gradient(45deg, #1976d2, #42a5f5); 
      color: #fff; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      margin: 0.5em;
      font-size: 1em;
      font-weight: bold;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover { 
      background: linear-gradient(45deg, #0d47a1, #1976d2);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
  </style>
</head>
<body>
  <div class="container" id="main-container">
    <h2>üéÆ Arcade Games</h2>
    <div class="user-email" id="user-email"></div>
    <div class="token-info">Tokens: <span id="token-count"></span></div>
    
    <div class="game-grid">
      <div class="game-card" onclick="startGame('snake', 5)">
        <div class="game-title">üêç Snake Game</div>
        <div class="game-description">Classic snake game. Eat food to grow longer!</div>
        <div class="game-cost">Cost: 5 tokens</div>
      </div>
      
      <div class="game-card" onclick="startGame('tetris', 10)">
        <div class="game-title">üß© Tetris</div>
        <div class="game-description">Stack blocks and clear lines!</div>
        <div class="game-cost">Cost: 10 tokens</div>
      </div>
      
      <div class="game-card" onclick="startGame('puzzle', 3)">
        <div class="game-title">üß© Number Puzzle</div>
        <div class="game-description">Slide tiles to arrange numbers in order!</div>
        <div class="game-cost">Cost: 3 tokens</div>
      </div>
    </div>
    
    <a class="back-link" href="index.html">‚Üê Back to Main Menu</a>
  </div>

  <div class="container game-area" id="game-area">
    <h2 id="game-title">Game</h2>
    <canvas id="game-canvas" class="game-canvas" width="400" height="400"></canvas>
    <div class="game-controls">
      <button onclick="pauseGame()" id="pause-btn">Pause</button>
      <button onclick="restartGame()" id="restart-btn">Restart</button>
      <button onclick="exitGame()" id="exit-btn">Exit Game</button>
    </div>
    <div id="game-score">Score: 0</div>
  </div>

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script src="js/token-manager.js"></script>
  <script>
    let currentUser = null;
    let currentEmail = null;
    let currentGame = null;
    let gameRunning = false;
    let gameScore = 0;
    
    // Game costs
    const gameCosts = {
      snake: 5,
      tetris: 10,
      puzzle: 3
    };

    async function getTokenCount(email) {
      return await window.tokenManager.getTokens(email);
    }
    
    async function setTokenCount(email, count) {
      return await window.tokenManager.setTokens(email, count);
    }
    
    function updateTokenDisplay(email) {
      window.tokenManager.updateTokenDisplay(email);
    }

    async function startGame(gameType, cost) {
      if (!currentEmail) {
        alert('Please sign in to play games!');
        return;
      }
      
      const tokens = await getTokenCount(currentEmail);
      if (tokens < cost) {
        alert(`Not enough tokens! You need ${cost} tokens to play this game.`);
        return;
      }
      
      // Deduct tokens
      await setTokenCount(currentEmail, tokens - cost);
      updateTokenDisplay(currentEmail);
      
      // Start the game
      currentGame = gameType;
      document.getElementById('main-container').style.display = 'none';
      document.getElementById('game-area').classList.add('active');
      document.getElementById('game-title').textContent = getGameTitle(gameType);
      
      initGame(gameType);
    }

    function getGameTitle(gameType) {
      const titles = {
        snake: 'üêç Snake Game',
        tetris: 'üß© Tetris',
        puzzle: 'üß© Number Puzzle'
      };
      return titles[gameType] || 'Game';
    }

    function initGame(gameType) {
      const canvas = document.getElementById('game-canvas');
      const ctx = canvas.getContext('2d');
      
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      if (gameType === 'snake') {
        initSnakeGame(ctx, canvas);
      } else if (gameType === 'tetris') {
        initTetrisGame(ctx, canvas);
      } else if (gameType === 'puzzle') {
        initPuzzleGame(ctx, canvas);
      }
    }

    function initSnakeGame(ctx, canvas) {
      let snake = [{x: 200, y: 200}];
      let food = {x: 100, y: 100};
      let dx = 10;
      let dy = 0;
      gameScore = 0;
      gameRunning = true;
      
      function drawSnake() {
        ctx.fillStyle = '#4CAF50';
        snake.forEach(segment => {
          ctx.fillRect(segment.x, segment.y, 10, 10);
        });
      }
      
      function drawFood() {
        ctx.fillStyle = '#FF5722';
        ctx.fillRect(food.x, food.y, 10, 10);
      }
      
      function moveSnake() {
        const head = {x: snake[0].x + dx, y: snake[0].y + dy};
        snake.unshift(head);
        
        if (head.x === food.x && head.y === food.y) {
          gameScore += 10;
          food = {
            x: Math.floor(Math.random() * 40) * 10,
            y: Math.floor(Math.random() * 40) * 10
          };
        } else {
          snake.pop();
        }
      }
      
      function gameLoop() {
        if (!gameRunning) return;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        moveSnake();
        drawSnake();
        drawFood();
        
        document.getElementById('game-score').textContent = `Score: ${gameScore}`;
        
        // Check collision with walls or self
        const head = snake[0];
        if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
          gameOver();
          return;
        }
        
        for (let i = 1; i < snake.length; i++) {
          if (head.x === snake[i].x && head.y === snake[i].y) {
            gameOver();
            return;
          }
        }
        
        setTimeout(gameLoop, 100);
      }
      
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowUp' && dy === 0) { dx = 0; dy = -10; }
        if (e.key === 'ArrowDown' && dy === 0) { dx = 0; dy = 10; }
        if (e.key === 'ArrowLeft' && dx === 0) { dx = -10; dy = 0; }
        if (e.key === 'ArrowRight' && dx === 0) { dx = 10; dy = 0; }
      });
      
      gameLoop();
    }

    function initTetrisGame(ctx, canvas) {
      // Simple tetris implementation
      ctx.fillStyle = '#2196F3';
      ctx.font = '20px Arial';
      ctx.fillText('Tetris Game Coming Soon!', 100, 200);
      ctx.fillText('Use arrow keys to move', 100, 230);
    }

    function initPuzzleGame(ctx, canvas) {
      // Simple puzzle implementation
      ctx.fillStyle = '#9C27B0';
      ctx.font = '20px Arial';
      ctx.fillText('Number Puzzle Coming Soon!', 80, 200);
      ctx.fillText('Slide tiles to arrange numbers', 80, 230);
    }

    function pauseGame() {
      gameRunning = !gameRunning;
      document.getElementById('pause-btn').textContent = gameRunning ? 'Pause' : 'Resume';
      if (gameRunning) {
        initGame(currentGame);
      }
    }

    function restartGame() {
      gameScore = 0;
      initGame(currentGame);
    }

    function exitGame() {
      gameRunning = false;
      document.getElementById('game-area').classList.remove('active');
      document.getElementById('main-container').style.display = 'block';
      currentGame = null;
    }

    function gameOver() {
      gameRunning = false;
      alert(`Game Over! Final Score: ${gameScore}`);
      exitGame();
    }

    // Netlify Identity integration
    function checkAuth() {
      const user = netlifyIdentity.currentUser();
      if (user) {
        currentUser = user;
        currentEmail = user.email;
        document.getElementById('user-email').textContent = 'Logged in as: ' + user.email;
        updateTokenDisplay(user.email);
      } else {
        currentUser = null;
        currentEmail = null;
        document.getElementById('user-email').textContent = 'Not signed in.';
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      if (window.netlifyIdentity) {
        netlifyIdentity.on("login", user => {
          currentUser = user;
          currentEmail = user.email;
          checkAuth();
        });
        netlifyIdentity.on("logout", () => {
          currentUser = null;
          currentEmail = null;
          checkAuth();
        });
        netlifyIdentity.on("init", () => {
          checkAuth();
        });
        netlifyIdentity.init();
      }
      checkAuth();
    });
  </script>
</body>
</html> 